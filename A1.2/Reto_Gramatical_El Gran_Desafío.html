<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego Tropical de Espa√±ol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%); /* Green tropical gradient */
            overflow-x: hidden;
            transition: background 0.5s;
            user-select: none; /* Prevent text selection during fast clicks */
        }
        h1, h2, h3, .font-tropical {
            font-family: 'Fredoka One', cursive;
        }
        .tropical-card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border: 4px solid #FDB813; /* Sun yellow */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        /* Button Styles */
        .btn-tropical {
            background-color: #FF8C00; /* Dark Orange */
            color: white;
            transition: transform 0.1s, background-color 0.2s, box-shadow 0.2s;
            border-bottom: 6px solid #E67E00;
        }
        .btn-tropical:active {
            transform: translateY(4px);
            border-bottom: 2px solid #E67E00;
            box-shadow: none;
        }
        .btn-tropical:hover {
            background-color: #FFA500;
            filter: brightness(1.1);
        }
        
        .option-btn {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-bottom: 4px solid #bbf7d0; /* light green shadow */
            cursor: pointer;
        }
        .option-btn:hover {
            transform: scale(1.02) translateY(-2px);
            background-color: #f0fdf4;
            border-color: #4ade80;
        }
        .option-btn:active {
            transform: scale(0.98) translateY(0);
            border-bottom: 0px;
        }

        /* Life Hearts */
        .life-heart {
            color: #FF4136;
            font-size: 1.8rem;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: inline-block;
        }
        .lost-life {
            color: #d1d5db; /* gray-300 */
            transform: scale(0.5) rotate(45deg);
            opacity: 0.5;
            filter: grayscale(100%);
        }
        
        /* Danger Mode (Last Life) */
        @keyframes pulse-danger {
            0% { transform: scale(1); filter: drop-shadow(0 0 2px red); }
            50% { transform: scale(1.3); filter: drop-shadow(0 0 10px red); }
            100% { transform: scale(1); filter: drop-shadow(0 0 2px red); }
        }
        .heart-danger {
            animation: pulse-danger 0.8s infinite;
            color: #ef4444;
        }
        .card-danger {
            border-color: #ef4444 !important; /* Red border */
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.6) !important;
        }
        
        /* Leaf decoration css */
        .leaf {
            position: absolute;
            width: 50px;
            height: 50px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23228B22'%3E%3Cpath d='M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C19,20 22,3 22,3C21,5 14,5.25 9,6.25C4,7.25 2,11.5 2,13.5C2,15.5 3.75,17.25 3.75,17.25C7,8 17,8 17,8Z' /%3E%3C/svg%3E");
            opacity: 0.2;
            pointer-events: none;
            z-index: 0;
            transition: all 1s;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            50% { transform: translateX(10px) rotate(5deg); }
            75% { transform: translateX(-10px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }
        .shake-effect {
            animation: shake 0.5s ease-in-out;
        }

        /* Certificate Styles */
        #certificate-container {
            display: none;
            background: #fff url('https://www.transparenttextures.com/patterns/cubes.png');
            border: 10px double #2E8B57;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        .cert-stamp {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #FDB813;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: rotate(-15deg);
        }

        /* Modal for feedback */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 30px;
            border: 4px solid #FF4136;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        /* Sound Toggle */
        #sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            color: #2E8B57;
            transition: transform 0.2s;
        }
        #sound-toggle:hover {
            transform: scale(1.1);
        }
        
        /* Mobile adjustments */
        @media (max-width: 640px) {
            #certificate-container {
                padding: 15px;
            }
            .cert-stamp {
                width: 50px;
                height: 50px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body id="main-body" class="min-h-screen flex items-center justify-center p-4 relative">

    <div id="header-container"></div>

    <!-- Sound Toggle Button -->
    <div id="sound-toggle" onclick="toggleSound()">
        <i id="sound-icon" class="fas fa-volume-up"></i>
    </div>

    <!-- Leaf Decorations -->
    <div class="leaf animate__animated animate__swing animate__infinite animate__slower" style="top: 10%; left: 5%; transform: rotate(45deg);"></div>
    <div class="leaf animate__animated animate__swing animate__infinite animate__slower" style="top: 80%; right: 10%; animation-delay: 1s; transform: rotate(-45deg);"></div>
    <div class="leaf animate__animated animate__swing animate__infinite animate__slower" style="top: 20%; right: 5%; animation-delay: 2s; transform: rotate(15deg);"></div>
    <div class="leaf animate__animated animate__swing animate__infinite animate__slower" style="bottom: 10%; left: 15%; animation-delay: 3s; transform: rotate(-90deg);"></div>

    <!-- START SCREEN -->
    <div id="start-screen" class="tropical-card w-full max-w-md p-8 text-center z-10 animate__animated animate__fadeInDown">
        <img src="https://tucaneo.com/wp-content/uploads/2025/11/Plantilla-2-e1764351536337.png" alt="Logo Tucaneo" class="mx-auto h-28 mb-6 object-contain drop-shadow-lg" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3069/3069172.png'">
        <h1 class="text-5xl text-green-700 mb-2 font-tropical drop-shadow-sm">¬°Aventura Tropical!</h1>
        <p class="text-gray-600 mb-6 text-lg">Demuestra tus conocimientos de espa√±ol.</p>
        
        <div class="mb-6 relative">
            <label class="block text-left text-gray-700 font-bold mb-2 ml-1" for="username">Nombre del Estudiante:</label>
            <input type="text" id="username" class="w-full px-5 py-3 border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-600 text-lg shadow-inner transition-colors" placeholder="Escribe tu nombre aqu√≠...">
        </div>

        <button onclick="startGame()" class="btn-tropical w-full font-bold py-4 px-6 rounded-2xl text-2xl shadow-xl hover:-translate-y-1">
            ¬°Comenzar Juego!
        </button>
        <p class="mt-4 text-sm text-gray-500 flex justify-center items-center gap-2">
            Tienes 3 vidas <span class="text-red-500 text-xl">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        </p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="hidden tropical-card w-full max-w-2xl p-6 z-10 relative">
        <!-- Header: Logo, Progress, Lives -->
        <div class="flex justify-between items-center mb-6 border-b-2 border-green-100 pb-4">
            <div class="flex items-center">
                <img src="https://tucaneo.com/wp-content/uploads/2025/11/Plantilla-2-e1764351536337.png" alt="Logo" class="h-10 mr-2" onerror="this.style.display='none'">
                <span id="question-counter" class="font-bold text-green-700 text-lg bg-green-100 px-3 py-1 rounded-full">1/15</span>
            </div>
            <div id="lives-container" class="flex space-x-2 bg-white px-3 py-1 rounded-full shadow-sm border border-gray-100">
                <i class="fas fa-heart life-heart">‚ù§Ô∏è</i>
                <i class="fas fa-heart life-heart">‚ù§Ô∏è</i>
                <i class="fas fa-heart life-heart">‚ù§Ô∏è</i>
            </div>
        </div>

        <!-- Question Area -->
        <div id="question-container" class="mb-8 text-center animate__animated">
            <p id="question-category" class="text-xs text-orange-500 font-bold uppercase tracking-widest mb-2 bg-orange-50 inline-block px-2 py-1 rounded">Categor√≠a</p>
            <h2 id="question-text" class="text-3xl font-bold text-gray-800 mb-2 leading-tight">¬øPregunta?</h2>
        </div>

        <!-- Options Area -->
        <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Buttons generated by JS -->
        </div>
    </div>

    <!-- INCORRECT MODAL (Removed 'flex' class to fix initial visibility bug) -->
    <div id="incorrect-modal" class="modal">
        <div class="modal-content animate__animated animate__bounceIn">
            <div class="text-7xl mb-4 animate__animated animate__headShake animate__infinite animate__slow">üò¢</div>
            <h2 class="text-3xl font-bold text-red-500 mb-2 font-tropical">¬°Paso a paso!</h2>
            <p class="text-gray-600 mb-6 text-lg">Esa no era la correcta. <br>¬°No te rindas, t√∫ puedes!</p>
            <button onclick="closeModal()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition transform hover:scale-105">
                Continuar
            </button>
        </div>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="game-over-screen" class="hidden tropical-card w-full max-w-md p-8 text-center z-10 animate__animated animate__fadeIn">
        <div class="text-8xl mb-4 animate__animated animate__tada">ü¶ú</div>
        <h1 class="text-4xl text-red-600 mb-4 font-tropical">¬°Juego Terminado!</h1>
        <p class="text-gray-600 mb-8 text-lg">Se acabaron las vidas, pero el aprendizaje contin√∫a.</p>
        <button onclick="resetGame()" class="btn-tropical w-full font-bold py-4 px-6 rounded-2xl text-2xl shadow-lg">
            Intentar de nuevo üîÑ
        </button>
    </div>

    <!-- VICTORY / CERTIFICATE SCREEN -->
    <div id="victory-screen" class="hidden w-full max-w-3xl z-10 flex flex-col items-center animate__animated animate__zoomIn">
        <div class="tropical-card p-6 mb-6 w-full text-center">
            <h1 class="text-4xl text-green-600 font-tropical mb-2">¬°Felicidades! üéâ</h1>
            <p class="text-gray-600 text-lg">Has completado el desaf√≠o tropical con √©xito.</p>
        </div>

        <!-- The Certificate -->
        <div id="certificate-container" class="bg-white text-gray-800 shadow-2xl w-full max-w-2xl mx-auto rounded-lg transform rotate-1 hover:rotate-0 transition duration-500">
            <div class="border-4 border-yellow-400 p-1 h-full rounded-lg">
                <div class="border-2 border-green-600 p-8 h-full rounded-lg relative bg-white">
                    <img src="https://tucaneo.com/wp-content/uploads/2025/11/Plantilla-2-e1764351536337.png" alt="Logo" class="h-20 mx-auto mb-4" onerror="this.style.display='none'">
                    <h2 class="text-5xl font-tropical text-green-700 mb-2 uppercase tracking-wide">Certificado</h2>
                    <p class="text-2xl text-gray-500 italic mb-6 font-serif">de Excelencia</p>
                    
                    <p class="text-lg mb-2">Este documento certifica que</p>
                    <h3 id="cert-name" class="text-4xl font-bold text-orange-500 mb-6 border-b-4 border-yellow-200 pb-2 inline-block min-w-[300px] font-tropical">Estudiante</h3>
                    <p class="text-lg mb-8 leading-relaxed">Ha superado el <strong>Desaf√≠o Tropical de Espa√±ol</strong><br>demostrando gran conocimiento.</p>
                    
                    <div class="flex justify-between items-end mt-8">
                        <div class="text-center">
                            <div class="w-40 border-b-2 border-black mb-2 mx-auto"></div>
                            <p class="text-sm text-gray-500 font-bold">Firma del Profesor</p>
                        </div>
                        <div class="cert-stamp animate__animated animate__pulse animate__infinite animate__slower">
                            100%<br>TOP
                        </div>
                        <div class="text-center">
                            <p id="cert-date" class="font-bold mb-2 text-lg">Fecha</p>
                            <p class="text-sm text-gray-500 font-bold">Fecha</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flex gap-4 mt-8 pb-8">
            <button onclick="window.print()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:-translate-y-1 flex items-center">
                üñ®Ô∏è Imprimir
            </button>
            <button onclick="resetGame()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:-translate-y-1">
                üîÑ Jugar de nuevo
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // --- AUDIO ENGINE (Web Audio API) ---
        // This generates sound using code instead of external files
        // so it NEVER breaks and doesn't rely on internet speed.
        
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        let soundEnabled = true;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // Helper to play a frequency
        function playTone(freq, type, duration, startTime = 0) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type; // 'sine', 'square', 'sawtooth', 'triangle'
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime + startTime);
            
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime + startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + startTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start(audioCtx.currentTime + startTime);
            osc.stop(audioCtx.currentTime + startTime + duration);
        }

        function playSound(type) {
            if (!soundEnabled) return;
            initAudio(); // Ensure context is running

            if (type === 'correct') {
                // Happy "Ding-Dong" (High Sine Waves)
                playTone(600, 'sine', 0.1);
                playTone(1200, 'sine', 0.4, 0.1);
            } 
            else if (type === 'wrong') {
                // Sad "Buzz" (Low Sawtooth Wave)
                playTone(150, 'sawtooth', 0.4);
                playTone(100, 'sawtooth', 0.4, 0.1);
            }
            else if (type === 'win') {
                // Victory Arpeggio
                playTone(400, 'triangle', 0.1, 0.0);
                playTone(500, 'triangle', 0.1, 0.1);
                playTone(600, 'triangle', 0.1, 0.2);
                playTone(800, 'triangle', 0.4, 0.3);
            }
            else if (type === 'lose') {
                // Falling slide
                playTone(300, 'triangle', 0.2, 0.0);
                playTone(250, 'triangle', 0.2, 0.2);
                playTone(200, 'triangle', 0.4, 0.4);
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const icon = document.getElementById('sound-icon');
            if (soundEnabled) {
                icon.className = 'fas fa-volume-up';
                // Play a tiny blip to confirm sound is on
                initAudio();
                playTone(800, 'sine', 0.1);
            } else {
                icon.className = 'fas fa-volume-mute';
            }
        }

        // --- DATA ---
        const questions = [
            {
                text: "Para decir 'We are going to eat', usamos la estructura:",
                category: "Futuro con Ir",
                options: ["Nosotros vamos a comer", "Nosotros van a comer", "Nosotros ir a comer", "Nosotros vamos comemos"],
                correct: 0
            },
            {
                text: "Completa la frase: 'Ellas _____ a la tienda.'",
                category: "Futuro con Ir",
                options: ["vamos", "vas", "van", "va"],
                correct: 2
            },
            {
                text: "¬øC√≥mo se dice 'I am thirsty' usando un modismo con tener?",
                category: "Modismos",
                options: ["Tengo hambre", "Tengo sed", "Soy sed", "Tengo miedo"],
                correct: 1
            },
            {
                text: "El modismo 'Acabar de + infinitivo' (ej: Acabo de llegar) significa:",
                category: "Modismos",
                options: ["To finish doing something", "To have just done something", "To stop doing something", "To try to do something"],
                correct: 1
            },
            {
                text: "¬øCu√°l es la forma correcta del adjetivo 'bueno' antes de un sustantivo masculino singular? (ej: ____ amigo)",
                category: "Adjetivos",
                options: ["bueno", "buenos", "buen", "buena"],
                correct: 2
            },
            {
                text: "Si decimos 'la gran mujer', ¬øqu√© significa 'gran' en este contexto?",
                category: "Adjetivos (Significado)",
                options: ["The big woman", "The great woman", "The old woman", "The tall woman"],
                correct: 1
            },
            {
                text: "Selecciona el comparativo correcto: 'Ella es _____ (older) que yo.'",
                category: "Comparativos",
                options: ["m√°s vieja", "mayor", "menor", "m√°s grande"],
                correct: 1
            },
            {
                text: "¬øC√≥mo se forma el adverbio de 'r√°pido'?",
                category: "Adverbios",
                options: ["R√°pidamente", "R√°pidomente", "R√°pido", "Con r√°pido"],
                correct: 0
            },
            {
                text: "Completa: 'Yo tengo _____ libros como t√∫.'",
                category: "Comparativos",
                options: ["tanto", "tantos", "tan", "m√°s"],
                correct: 1
            },
            {
                text: "¬øQu√© significa 'Tener √©xito'?",
                category: "Modismos",
                options: ["To be in a hurry", "To be successful", "To be excited", "To have an exit"],
                correct: 1
            },
            {
                text: "En la frase 'Alg√∫n d√≠a volver√©', ¬øpor qu√© 'alguno' pierde la 'o'?",
                category: "Adjetivos",
                options: ["Porque es femenino", "Porque precede a un masculino singular", "Porque es plural", "Es un error"],
                correct: 1
            },
            {
                text: "Traduce: 'We have to study' usando un modismo.",
                category: "Modismos",
                options: ["Tenemos que estudiar", "Tratamos de estudiar", "Vamos a estudiar", "Dejamos de estudiar"],
                correct: 0
            },
            {
                text: "¬øCu√°l es el superlativo de 'bueno'?",
                category: "Comparativos",
                options: ["El m√°s bueno", "El mejor", "El buen√≠simo", "El mayor"],
                correct: 1
            },
            {
                text: "'Tener dolor de cabeza' significa:",
                category: "Modismos",
                options: ["To have a headache", "To have a stomachache", "To be crazy", "To be worried"],
                correct: 0
            },
            {
                text: "Si algo pasa 'frecuentemente', pasa con:",
                category: "Adverbios",
                options: ["Frecuencia", "Tristeza", "Rapidez", "Cuidado"],
                correct: 0
            }
        ];

        // --- GAME STATE ---
        let currentQuestionIndex = 0;
        let lives = 3;
        let userName = "";

        // --- DOM ELEMENTS ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const victoryScreen = document.getElementById('victory-screen');
        const incorrectModal = document.getElementById('incorrect-modal');
        const livesContainer = document.getElementById('lives-container');
        const questionCounter = document.getElementById('question-counter');
        const questionText = document.getElementById('question-text');
        const questionCategory = document.getElementById('question-category');
        const optionsContainer = document.getElementById('options-container');
        const questionContainer = document.getElementById('question-container');
        const mainBody = document.getElementById('main-body');

        // --- LOGIC ---

        function startGame() {
            // Important: Initialize audio context on first user interaction
            initAudio();

            const nameInput = document.getElementById('username').value;
            if (!nameInput.trim()) {
                alert("Por favor, escribe tu nombre para empezar.");
                return;
            }
            userName = nameInput;
            
            // Reset state
            lives = 3;
            currentQuestionIndex = 0;
            updateLivesUI();
            
            // Switch Screens
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameOverScreen.classList.add('hidden');
            victoryScreen.classList.add('hidden');
            
            // Ensure modal is hidden
            incorrectModal.style.display = 'none';

            loadQuestion();
        }

        function loadQuestion() {
            // Animate Question Entry
            questionContainer.classList.remove('animate__fadeInRight');
            void questionContainer.offsetWidth; // Trigger reflow
            questionContainer.classList.add('animate__fadeInRight');

            // Reset Options Container Animation
            optionsContainer.classList.remove('animate__fadeInUp');
            void optionsContainer.offsetWidth;
            optionsContainer.classList.add('animate__fadeInUp');

            if (currentQuestionIndex >= questions.length) {
                showVictory();
                return;
            }

            const q = questions[currentQuestionIndex];
            
            // Update Text
            questionCounter.innerText = `${currentQuestionIndex + 1}/${questions.length}`;
            questionText.innerText = q.text;
            questionCategory.innerText = q.category;
            
            // Generate Options with stagger animation
            optionsContainer.innerHTML = '';
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-4 bg-white border-2 border-green-200 rounded-xl text-gray-700 font-semibold text-lg shadow-sm";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(index);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex) {
            const q = questions[currentQuestionIndex];
            
            if (selectedIndex === q.correct) {
                // Correct!
                playSound('correct');
                triggerConfetti();
                currentQuestionIndex++;
                setTimeout(() => {
                    loadQuestion();
                }, 800); // Wait for confetti a bit
            } else {
                // Incorrect
                playSound('wrong');
                lives--;
                
                // Shake Animation
                gameScreen.classList.add('shake-effect');
                setTimeout(() => {
                    gameScreen.classList.remove('shake-effect');
                }, 500);

                updateLivesUI();
                showIncorrectModal();
                
                if (lives <= 0) {
                   // Logic handled after modal closes
                }
            }
        }

        function showIncorrectModal() {
            incorrectModal.style.display = "flex";
        }

        function closeModal() {
            incorrectModal.style.display = "none";
            if (lives <= 0) {
                showGameOver();
            } else {
                // Stay on question
            }
        }

        function updateLivesUI() {
            livesContainer.innerHTML = '';
            
            // Danger Mode Check (Last Life)
            if (lives === 1) {
                gameScreen.classList.add('card-danger');
            } else {
                gameScreen.classList.remove('card-danger');
            }

            for (let i = 0; i < 3; i++) {
                const heart = document.createElement('span');
                heart.innerHTML = '‚ù§Ô∏è';
                
                if (i < lives) {
                    // Active heart
                    heart.className = 'life-heart';
                    // If it's the last life (index 0 and lives is 1), animate it
                    if (lives === 1 && i === 0) {
                        heart.classList.add('heart-danger');
                    }
                } else {
                    // Lost heart
                    heart.className = 'life-heart lost-life';
                }
                
                livesContainer.appendChild(heart);
            }
        }

        function showGameOver() {
            playSound('lose');
            gameScreen.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
        }

        function showVictory() {
            playSound('win');
            gameScreen.classList.add('hidden');
            victoryScreen.classList.remove('hidden');
            
            // Fill certificate
            document.getElementById('cert-name').innerText = userName;
            const now = new Date();
            document.getElementById('cert-date').innerText = now.toLocaleDateString('es-ES');
            document.getElementById('certificate-container').style.display = "block"; // Make sure it's visible for print
            
            // Big confetti
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            var random = function(min, max) { return Math.random() * (max - min) + min; }

            var interval = setInterval(function() {
              var timeLeft = animationEnd - Date.now();

              if (timeLeft <= 0) {
                return clearInterval(interval);
              }

              var particleCount = 50 * (timeLeft / duration);
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        function triggerConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#FF8C00', '#56ab2f', '#FDB813']
            });
        }

        function resetGame() {
            // Remove danger styles
            gameScreen.classList.remove('card-danger');
            
            startScreen.classList.remove('hidden');
            gameOverScreen.classList.add('hidden');
            victoryScreen.classList.add('hidden');
            
            // Reset modal display state just in case
            incorrectModal.style.display = 'none';
        }

    </script>

  <script>
    fetch('/nav.html').then(function(r){ return r.text(); }).then(function(data){
      var el = document.getElementById('header-container');
      if (el) {
      el.innerHTML = data;
      var scripts = el.querySelectorAll('script');
      for (var i = 0; i < scripts.length; i++) {
        var sc = scripts[i];
        var ns = document.createElement('script');
        if (sc.src) ns.src = sc.src; else ns.textContent = sc.textContent;
        document.body.appendChild(ns);
      }
    }
    });
  </script>

</body>
</html>