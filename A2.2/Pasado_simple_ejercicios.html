<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Tucaneo A2.2: Pasado simple — Ejercicios (Pretérito Indefinido)</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/theme/white.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;700&family=Handlee&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* =========================================
       1. VARIABLES Y BASE (VISIBILIDAD ALTA)
       ========================================= */
        :root {
            --primary: #004d40;
            --accent: #ff6f00;
            --text-main: #0f172a;
            /* Texto casi negro para máximo contraste */
            --text-secondary: #334155;
            /* Gris oscuro (antes era muy claro) */
            --bg-light: #fefce8;
            --danger: #ef4444;
        }

        /* Mantenemos la magia del Zoom Nativo */
        html,
        body {
            background-color: var(--bg-light);
            font-family: 'Lato', sans-serif;
            height: 100%;
            overflow-y: auto !important;
            /* CRÍTICO: NO BORRAR */
        }

        /* =========================================
       2. REVEAL.JS - TIPOGRAFÍA (COMPACTA Y LEGIBLE)
       ========================================= */
        /* Bajamos un poco la base para que no se sienta "gigante" */
        .reveal {
            color: var(--text-main);
            font-size: 28px;
            font-weight: 500;
        }

        /* Títulos */
        .reveal h1 {
            font-size: 2.5em !important;
            line-height: 1.1 !important;
            color: var(--primary);
            margin-bottom: 0.5em !important;
        }

        /* --- SKELETON FIX: ENFORCE TAILWIND COLORS --- */
        /* Overrides Reveal.js specific selectors like '.reveal h1' */
        .reveal .text-white {
            color: #ffffff !important;
        }

        .reveal .text-slate-50 {
            color: #f8fafc !important;
        }

        .reveal .text-yellow-200 {
            color: #fef08a !important;
        }

        .reveal .text-yellow-300 {
            color: #fde047 !important;
        }

        .reveal .text-yellow-400 {
            color: #facc15 !important;
        }

        .reveal .text-emerald-100 {
            color: #d1fae5 !important;
        }

        .reveal .text-emerald-200 {
            color: #a7f3d0 !important;
        }


        .reveal h2 {
            font-size: 1.8em !important;
            color: var(--primary);
            font-weight: 800;
            margin-bottom: 0.6em !important;
        }

        .reveal h3 {
            font-size: 1.4em !important;
            font-weight: 700;
            color: var(--text-main);
        }

        /* SOLUCIÓN AL TEXTO GRIS INVISIBLE */
        /* Forzamos un color mucho más oscuro y un peso semi-negrita */
        .reveal .text-sm,
        .reveal .text-xs,
        .reveal .text-gray-400,
        .reveal .text-gray-500 {
            color: var(--text-secondary) !important;
            /* Gris Oscuro */
            font-weight: 600 !important;
            /* Más gordita la letra */
            opacity: 0.9 !important;
            /* Quitamos transparencias */
        }

        .reveal .text-sm {
            font-size: 0.85em !important;
        }

        .reveal .text-xs {
            font-size: 0.75em !important;
        }

        /* =========================================
       3. ESTILO DE TARJETAS (CORREGIDO Y SEGURO)
       ========================================= */
        /* Modificado para permitir colores de fondo (como el verde) */
        .glass-card {
            /* Eliminamos la orden agresiva de transparencia */
            backdrop-filter: blur(8px);
            /* Efecto borroso bonito */
            -webkit-backdrop-filter: blur(8px);
            /* Para Safari/iPhone */

            /* El resto lo dejamos que Tailwind lo controle en el HTML */
            width: 100%;
            margin: 0 auto;
        }

        /* Tarjetas internas: Más compactas y definidas */
        .card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
        }

        /* =========================================
       4. LAYOUT CONTROLADO (SCROLL + ARREGLO DE TÍTULOS)
       ========================================= */
        .reveal .slides {
            width: 100% !important;
            height: 100% !important;
            padding: 0 !important;
            margin: 0 !important;
            pointer-events: none;
        }

        .reveal section {
            height: 100vh !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            display: block !important;

            /* AUMENTÉ ESTO: 100px arriba para bajar todo y que respete el menú */
            padding: 100px 20px 80px 20px !important;

            pointer-events: auto !important;
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch;
        }

        /* --- REGLA MÁGICA NUEVA --- */
        /* Esto obliga al contenido a empezar desde arriba, anulando el 'justify-center' de Tailwind */
        .reveal section>div {
            height: auto !important;
            /* Permite que crezca hacia abajo */
            min-height: 100% !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: flex-start !important;
            /* ¡CLAVE! Alinea al inicio, no al centro */
        }

        /* AQUÍ ESTÁ EL TRUCO DE LA PROPORCIÓN: */
        .slide-container {
            width: 90% !important;
            max-width: 1200px !important;
            margin: 0 auto;
        }

        /* =========================================
       5. INPUTS VISIBLES (IGUAL QUE ANTES)
       ========================================= */
        .clean-input {
            width: 100%;
            background: #f8fafc;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            padding: 12px 16px;
            font-family: 'Handlee', cursive;
            font-size: 1.1em;
            color: var(--primary) !important;
            font-weight: bold;
            outline: none;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.02);
        }

        .clean-input:focus {
            border-color: var(--accent);
            background: #fff;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .clean-input::placeholder {
            color: #64748b !important;
            font-family: 'Lato', sans-serif;
            font-size: 0.9em;
            font-weight: 500;
        }

        /* =========================================
       6. UI Y UTILIDADES
       ========================================= */
        #tucaneo-drawer {
            position: fixed;
            top: 0;
            right: -150vw;
            width: 50vw;
            height: 100vh;
            background: #fff;
            z-index: 20000;
            box-shadow: -10px 0 50px rgba(0, 0, 0, 0.2);
            transition: right 0.4s;
            display: flex;
            flex-direction: column;
        }

        #tucaneo-drawer.is-open {
            right: 0 !important;
        }

        #safe-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 20001;
            background: var(--danger);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #fixed-logo {
            position: fixed;
            top: 30px;
            left: 40px;
            width: 100px;
            z-index: 5000;
        }

        #top-nav {
            position: fixed;
            top: 30px;
            right: 40px;
            z-index: 5000;
            display: flex;
            gap: 15px;
        }

        #floating-cta {
            position: fixed;
            bottom: 30px;
            left: 40px;
            z-index: 5000;
            font-size: 12px;
            color: var(--primary);
            font-weight: bold;
            opacity: 0.8;
            letter-spacing: 1px;
        }

        .nav-btn {
            padding: 8px 20px;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            font-weight: bold;
            font-size: 13px;
            text-decoration: none;
        }

        .nav-btn.zoom {
            display: none !important;
        }

        .nav-btn.download {
            background-color: var(--primary);
        }

        .nav-btn.exit {
            background-color: #64748b;
        }

        #scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 6px;
            background: var(--accent);
            width: 0%;
            z-index: 9999;
        }

        #back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 4000;
            cursor: pointer;
        }

        #back-to-top.visible {
            display: flex;
        }


        /* =========================================
       7. MÓVIL: SOLUCIÓN FINAL (SCROLL REAL)
       ========================================= */
        @media (max-width: 1024px) {

            /* 1. FORZAR SCROLL EN EL CUERPO (La clave para que baje) */

            /* --- ¡ESTO HACE VISIBLES LOS EJERCICIOS! --- */
            .reveal .fragment {
                opacity: 1 !important;
                visibility: visible !important;
                transform: none !important;
                animation: none !important;
            }


            html,
            body {
                height: auto !important;
                min-height: 100% !important;
                overflow-y: scroll !important;
                /* Fuerza la barra de scroll */
                -webkit-overflow-scrolling: touch;
                /* Scroll suave en iPhone */
                position: relative !important;
            }

            /* 2. DESACTIVAR REVEAL.JS (Convertir en lista vertical) */
            .reveal {
                height: auto !important;
                overflow: visible !important;
                position: relative !important;
                touch-action: auto !important;
            }

            .reveal .slides {
                position: static !important;
                /* Deja de flotar */
                width: 100% !important;
                height: auto !important;
                display: flex !important;
                flex-direction: column !important;
                /* Apilar uno tras otro */
                padding: 20px 15px 150px 15px !important;
                /* Espacio extra abajo */
                transform: none !important;
                top: auto !important;
                left: auto !important;
                pointer-events: none;
                /* El contenedor no bloquea, los hijos sí */
            }

            /* 3. CADA DIAPOSITIVA ES UN BLOQUE */
            .reveal section {
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
                position: relative !important;
                top: auto !important;
                height: auto !important;
                min-height: auto !important;
                margin-bottom: 40px !important;
                /* Espacio entre diapositivas */
                pointer-events: auto !important;
                /* ¡Habilitar interacción! */
                transform: none !important;
            }

            /* 4. ELEMENTOS INTERNOS (Para que no se salgan) */
            .slide-container,
            .card,
            .glass-card {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
                padding: 20px !important;
                box-sizing: border-box !important;
            }

            /* 5. INPUTS FUNCIONALES */
            .clean-input {
                pointer-events: auto !important;
                z-index: 5000 !important;
                /* Asegurar que esté encima */
                font-size: 16px !important;
                background: #fff !important;
                width: 100% !important;
            }

            /* 6. ARREGLAR GRILLAS (Todo en una columna) */
            .grid,
            .grid-cols-2,
            .md\:grid-cols-2,
            .lg\:grid-cols-12 {
                display: flex !important;
                flex-direction: column !important;
                gap: 20px !important;
            }

            /* 7. LIMPIEZA VISUAL */
            .mobile-grid-2 {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 15px !important;
            }

            .reveal h1 {
                font-size: 2.2em !important;
                margin-top: 20px !important;
            }

            .reveal img {
                max-height: 250px !important;
                width: auto !important;
                margin: 0 auto !important;
            }

            /* Ocultar controles de PC */
            #btn-zoom,
            .nav-btn.zoom,
            #premium-dock,
            .reveal .controls,
            .reveal .progress {
                display: none !important;
            }

            /* Ajustar barra superior */
            #fixed-logo {
                width: 60px;
                top: 10px;
                left: 10px;
            }

            #top-nav {
                top: 10px;
                right: 10px;
            }

            .nav-btn {
                width: 36px;
                height: 36px;
                padding: 0;
                justify-content: center;
            }

            .nav-btn span {
                display: none;
            }
        }

        /* --- PARCHE DE CONTRASTE (CORREGIDO) --- */

        /* Usamos este selector especial para que el navegador entienda el color hexadecimal */
        [class*="bg-[#004d40]"] h1,
        [class*="bg-[#004d40]"] h2,
        [class*="bg-[#004d40]"] h3,
        [class*="bg-[#004d40]"] p,
        [class*="bg-[#004d40]"] i,
        [class*="bg-[#004d40]"] span,
        [class*="bg-[#004d40]"] li,
        [class*="bg-[#004d40]"] .text-sm,
        [class*="bg-[#004d40]"] .text-xs,
        [class*="bg-[#004d40]"] .text-gray-400,
        [class*="bg-[#004d40]"] .text-gray-500 {
            color: #ffffff !important;
            /* BLANCO OBLIGATORIO */
            opacity: 1 !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
        }

        /* También aplicamos la corrección para el color primario de Tailwind */
        .bg-primary h1,
        .bg-primary h2,
        .bg-primary h3,
        .bg-primary p,
        .bg-primary span,
        .bg-primary i {
            color: #ffffff !important;
        }

        /* --- CORRECCIÓN DEFINITIVA PARA FONDOS OSCUROS (DETECTIVE) --- */
        /* Esto asegura que cualquier texto dentro de un contenedor oscuro SEA BLANCO, sin importar la regla global */
        .bg-slate-800 .text-sm,
        .bg-slate-800 .text-xs,
        .bg-slate-800 p,
        .bg-slate-800 h1,
        .bg-slate-800 h2,
        .bg-slate-800 h3,
        .bg-slate-800 .italic {
            color: rgba(255, 255, 255, 0.95) !important;
            opacity: 1 !important;
        }

        /* Y para el texto específicamente coloreado (como Clue #1 en esmeralda), lo respetamos pero brillando */
        .bg-slate-800 .text-emerald-400 {
            color: #34d399 !important;
            /* Verde brillante */
        }


        /* --- CRITICAL CONTRAST FIX FOR DARK CARDS (V2.1 - GLOBAL MANAGE) --- */
        /* Support for both .class on section AND data-state on parent */

        /* 1. SLATE DARK CARDS */
        .reveal [class*="bg-slate-800"],
        .reveal.bg-slate-800,
        /* data-state support */
        .reveal [class*="from-slate-800"],
        .reveal.from-slate-800,
        /* data-state support */
        .reveal [class*="from-gray-800"],
        .reveal [class*="from-zinc-800"],
        .reveal [class*="from-stone-800"],
        .reveal [class*="from-neutral-800"] {
            background-color: #1e293b !important;
            color: #ffffff !important;
        }

        /* 2. PURPLE/INDIGO DARK CARDS */
        .reveal [class*="from-purple-900"],
        .reveal.from-purple-900,
        .reveal [class*="from-indigo-900"],
        .reveal.from-indigo-900 {
            background-color: #3b0764 !important;
            color: #ffffff !important;
        }

        /* 3. EMERALD/TEAL/BLUE DARK CARDS */
        .reveal [class*="from-emerald-900"],
        .reveal.from-emerald-900,
        .reveal [class*="from-teal-900"],
        .reveal.from-teal-900 {
            background-color: #064e3b !important;
            color: #ffffff !important;
        }


        .reveal [class*="from-blue-900"] {
            background-color: #1e3a8a !important;
            /* Fallback Solid Blue-900 */
            color: #ffffff !important;
        }

        /* 1. Force Headers to White/Light by default in these cards (Overrides .reveal h3 rule) */
        .reveal [class*="bg-slate-800"] h1,
        .reveal.bg-slate-800 h1,
        .reveal.bg-slate-800 h2,
        .reveal.bg-slate-800 h3,
        .reveal [class*="bg-slate-800"] h2,
        .reveal [class*="bg-slate-800"] h3,
        .reveal [class*="from-slate-800"] h1,
        .reveal.from-slate-800 h1,
        .reveal.from-slate-800 h2,
        .reveal.from-slate-800 h3,
        .reveal [class*="from-slate-800"] h2,
        .reveal [class*="from-slate-800"] h3,
        .reveal [class*="from-purple-900"] h1,
        .reveal.from-purple-900 h1,
        .reveal.from-purple-900 h2,
        .reveal.from-purple-900 h3,
        .reveal [class*="from-purple-900"] h2,
        .reveal [class*="from-purple-900"] h3,
        .reveal [class*="from-emerald-900"] h1,
        .reveal.from-emerald-900 h1,
        .reveal.from-emerald-900 h2,
        .reveal.from-emerald-900 h3,
        .reveal [class*="from-emerald-900"] h2,
        .reveal [class*="from-emerald-900"] h3 {
            color: #ffffff !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            /* Add shadow for better legibility */
        }

        /* 2. Force .text-sm and .text-xs to Light Slate (Overriding the dark gray rule) */
        .reveal [class*="bg-slate-800"] .text-sm,
        .reveal.bg-slate-800 .text-sm,
        .reveal [class*="bg-slate-800"] .text-xs,
        .reveal [class*="from-slate-800"] .text-sm,
        .reveal.from-slate-800 .text-sm,
        .reveal [class*="from-slate-800"] .text-xs,
        .reveal [class*="from-purple-900"] .text-sm,
        .reveal.from-purple-900 .text-sm,
        .reveal [class*="from-purple-900"] .text-xs,
        .reveal [class*="from-emerald-900"] .text-sm,
        .reveal.from-emerald-900 .text-sm,
        .reveal.from-emerald-900 .text-xs,
        .reveal [class*="from-emerald-900"] .text-xs {
            color: #e2e8f0 !important;
            /* Slate-200 */
            opacity: 1 !important;
            font-weight: 500 !important;
        }

        /* 3. Restore Specific Colors for emphasized text (High Specificity) */
        /* We use * selector to catch any element inside the dark card with these colors */
        .reveal [class*="from-slate-800"] .text-orange-400,
        .reveal [class*="bg-slate-800"] .text-orange-400 {
            color: #fb923c !important;
        }

        .reveal [class*="from-slate-800"] .text-orange-300 {
            color: #fdba74 !important;
        }

        .reveal [class*="from-slate-800"] .text-emerald-300 {
            color: #6ee7b7 !important;
        }

        .reveal [class*="from-slate-800"] .text-emerald-400 {
            color: #34d399 !important;
        }

        .reveal [class*="from-slate-800"] .text-blue-300 {
            color: #93c5fd !important;
        }

        .reveal [class*="from-slate-800"] .text-blue-400 {
            color: #60a5fa !important;
        }

        .reveal [class*="from-slate-800"] .text-cyan-300 {
            color: #67e8f9 !important;
        }

        .reveal [class*="from-slate-800"] .text-teal-300 {
            color: #5eead4 !important;
        }

        .reveal [class*="from-slate-800"] .text-purple-300 {
            color: #d8b4fe !important;
        }

        .reveal [class*="from-slate-800"] .text-yellow-400 {
            color: #facc15 !important;
        }

        /* Purple/Other Dark Cards Exceptions */
        .reveal [class*="from-purple-900"] .text-orange-300,
        .reveal [class*="from-purple-900"] .text-orange-400 {
            color: #fb923c !important;
        }

        .reveal [class*="from-purple-900"] .text-purple-300 {
            color: #d8b4fe !important;
        }

        /* Ensure bold text is white if no other color */
        .reveal [class*="from-slate-800"] strong,
        .reveal [class*="bg-slate-800"] strong {
            color: white !important;
        }

        /* Opcional: Si usas la clase 'bg-primary' de Tailwind */
        .bg-primary h1,
        .bg-primary h2,
        .bg-primary p {
            color: #ffffff !important;
        }

        /* =========================================
           INLINE TEXT INPUT STYLING
           ========================================= */
        .text-input-inline {
            display: inline-block;
            min-width: 100px;
            max-width: 150px;
            padding: 4px 8px;
            margin: 0 4px;
            border: none;
            border-bottom: 2px solid #10b981;
            background: transparent;
            font-size: inherit;
            font-weight: 600;
            color: #059669;
            text-align: center;
            transition: all 0.3s ease;
            outline: none;
        }

        .text-input-inline:focus {
            border-bottom-color: #f97316;
            background: #fef3c7;
            transform: scale(1.05);
        }

        .text-input-inline.correct {
            border-bottom-color: #10b981;
            background: #d1fae5;
            color: #047857;
        }

        .text-input-inline.incorrect {
            border-bottom-color: #ef4444;
            background: #fee2e2;
            color: #dc2626;
        }

        /* =========================================
           ANIMACIONES PARA DIAPOSITIVAS
           ========================================= */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-scale-in { animation: scaleIn 0.5s ease-out forwards; }
        .slide-card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .slide-card-hover:hover { transform: translateY(-4px); box-shadow: 0 12px 24px -8px rgba(0,0,0,0.15); }
    </style>




</head>

<body>

    <div id="header-container"></div>

    <div id="scroll-progress"></div>

    <img id="fixed-logo" src="https://tucaneo.com/wp-content/uploads/2025/11/Plantilla-2-e1764351536337.png"
        alt="Tucaneo Academy">
    <a href="https://tucaneo.com" id="floating-cta">TUCANEO.COM</a>

    <div id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <i class="fas fa-arrow-up"></i>
    </div>

    <div id="tucaneo-drawer">
        <button id="safe-close-btn" onclick="toggleDrawer()"><i class="fas fa-times"></i></button>
        <div id="tools-root" style="width: 100%; height: 100%;"></div>
    </div>

    <div id="top-nav">
        <button id="btn-zoom" onclick="forceZoom()" class="nav-btn zoom" title="Modo Lectura"><i
                class="fas fa-search-plus"></i> <span>Zoom</span></button>
        <a href="#" class="nav-btn download" onclick="window.print()"><i class="fas fa-file-pdf"></i>
            <span>PDF</span></a>
        <a href="https://tucaneo.com/" class="nav-btn exit"><i class="fas fa-sign-out-alt"></i> <span>Salir</span></a>
    </div>

    <div id="premium-dock"
        class="fixed left-6 top-1/2 -translate-y-1/2 z-[6000] flex flex-col items-center gap-3 p-2 bg-white/80 backdrop-blur-xl rounded-full shadow-2xl border border-white/50 transition-all hover:scale-[1.02]">

        <div class="flex flex-col gap-2 bg-gray-100/50 p-1 rounded-full">
            <button onclick="openTool('board')" title="Abrir Pizarra"
                class="group relative w-12 h-12 rounded-full bg-white shadow-sm hover:shadow-md flex items-center justify-center text-orange-600 transition-all hover:translate-x-1 active:scale-95">
                <i class="fas fa-pen-nib text-xl"></i>
                <span
                    class="absolute left-full ml-3 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none whitespace-nowrap z-50">Pizarra</span>
            </button>
            <button onclick="openTool('vocab')" title="Glosario"
                class="group relative w-12 h-12 rounded-full bg-white shadow-sm hover:shadow-md flex items-center justify-center text-emerald-700 transition-all hover:translate-x-1 active:scale-95">
                <i class="fas fa-book text-xl"></i>
                <span
                    class="absolute left-full ml-3 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none whitespace-nowrap z-50">Glosario</span>
            </button>
        </div>

        <div class="h-px w-6 bg-gray-300/50 my-1"></div>

        <div class="flex flex-col gap-2">
            <button onclick="react('confetti')" title="Fiesta"
                class="group relative w-12 h-12 rounded-full bg-gradient-to-tr from-yellow-400 to-orange-500 shadow-lg hover:shadow-xl flex items-center justify-center text-white transition-all hover:translate-x-1 hover:rotate-12 active:scale-95">
                <i class="fas fa-party-popper text-xl"></i>
            </button>
            <button onclick="react('applause')" title="Aplausos"
                class="group relative w-12 h-12 rounded-full bg-gradient-to-tr from-blue-400 to-indigo-500 shadow-lg hover:shadow-xl flex items-center justify-center text-white transition-all hover:translate-x-1 hover:-rotate-12 active:scale-95">
                <i class="fas fa-hands-clapping text-xl"></i>
            </button>
        </div>

        <div class="h-px w-6 bg-gray-300/50 my-1"></div>

        <div class="flex flex-col gap-1 bg-gray-100/50 p-1 rounded-full">
            <button onclick="react('error')"
                class="w-10 h-10 rounded-full bg-white hover:bg-red-50 text-red-400 shadow-sm flex items-center justify-center transition-all border border-transparent hover:border-red-100 hover:scale-110"
                title="Error">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>
    </div>

    <div class="reveal">
        <div class="slides">

            <!-- ========== SLIDE 1: Portada — Dominando el Pasado ========== -->
            <section data-background-color="#004d40">
                <div class="slide-container h-full flex flex-col justify-center items-center text-center relative overflow-hidden px-4">
                    <!-- Detalle temático: línea de tiempo / pasado -->
                    <div class="absolute top-8 right-8 md:top-12 md:right-12 text-white/15" aria-hidden="true">
                        <i class="fas fa-clock text-6xl md:text-7xl"></i>
                    </div>
                    <div class="absolute bottom-24 left-8 md:left-12 text-white/10" aria-hidden="true">
                        <i class="fas fa-history text-5xl md:text-6xl"></i>
                    </div>

                    <h1 class="text-white text-4xl md:text-6xl font-playfair font-bold mb-2 drop-shadow-md animate-fade-in tracking-tight">Dominando el Pasado</h1>
                    <p class="text-amber-300 text-xl md:text-2xl italic font-light tracking-wide mb-6 animate-fade-in" style="animation-delay: 0.1s">El Arte de los Regulares</p>

                    <!-- Caja de texto legible: fondo claro, texto oscuro -->
                    <div class="bg-white rounded-2xl shadow-xl border border-white/20 px-6 py-5 max-w-2xl mb-5 animate-fade-in text-left" style="animation-delay: 0.2s">
                        <p class="text-slate-700 text-sm md:text-base leading-relaxed font-medium m-0">They say those who don't know their history are doomed to repeat it. But in Spanish, if you don't know the past tense, you just can't tell your history at all! Today we leave the present behind to master the <strong class="text-[#004d40]">Pretérito Indefinido</strong>. No irregularities, no traps—just the pure, rhythmic logic of regular verbs. Ready to become a storyteller?</p>
                    </div>

                    <div class="flex items-center gap-3 bg-amber-400 text-slate-900 px-5 py-2.5 rounded-xl shadow-lg border border-amber-500/80 animate-scale-in font-bold text-base" style="animation-delay: 0.35s">
                        <i class="fas fa-bullseye text-xl"></i>
                        <span>El Reto: Aprender a usar el pasado con precisión quirúrgica.</span>
                    </div>
                </div>
            </section>

            <!-- ========== SLIDE 2: Juego 1 — The Agenda Auditor ========== -->
            <section id="juego-1-agenda-auditor">
                <style>
                    .agenda-auditor-row.correct { background-color: #f0fdf4 !important; border-left: 4px solid #16a34a; }
                    .agenda-auditor-row.incorrect { background-color: #fef2f2 !important; border-left: 4px solid #dc2626; }
                    .agenda-auditor-btn { transition: all 0.2s ease; }
                    .agenda-auditor-btn.selected { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
                    .agenda-auditor-btn.btn-confirmar.selected { background: #16a34a !important; color: white !important; border-color: #15803d; }
                    .agenda-auditor-btn.btn-negar.selected { background: #dc2626 !important; color: white !important; border-color: #b91c1c; }
                </style>
                <div class="slide-container h-full flex flex-col justify-start">
                    <!-- Encabezado del juego -->
                    <div class="flex flex-wrap items-center gap-3 mb-4">
                        <span class="bg-amber-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Juego 1</span>
                        <span class="bg-slate-700 text-amber-300 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Misión: Auditor</span>
                        <div class="flex items-center gap-3 ml-auto">
                            <div class="bg-slate-800 text-white p-3 rounded-xl shadow-lg">
                                <i class="fas fa-balance-scale text-2xl text-amber-400"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl md:text-3xl font-black text-slate-800 m-0 leading-tight">The Agenda Auditor</h2>
                                <p class="text-slate-600 text-sm font-semibold mt-0.5">¿La afirmación del cliente coincide con la agenda? Confirma o niega.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Instrucciones -->
                    <div class="bg-amber-50 border-l-4 border-amber-500 rounded-r-xl p-3 mb-4 shadow-sm">
                        <p class="text-slate-700 text-sm m-0 font-medium"><i class="fas fa-list-ol text-amber-600 mr-1"></i> Compara cada afirmación del cliente con la actividad de la agenda. <strong>Confirmar</strong> si coincide, <strong>Negar</strong> si no. Luego <strong>Verificar respuestas</strong>.</p>
                    </div>

                    <!-- Tabla interactiva -->
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-8 border-amber-500 flex-1 min-h-0 flex flex-col">
                        <div class="overflow-auto flex-1">
                            <table class="w-full text-sm agenda-auditor-table">
                                <thead class="sticky top-0 z-10">
                                    <tr class="bg-slate-800 text-white">
                                        <th class="p-3 text-left font-bold w-16">Hora</th>
                                        <th class="p-3 text-left font-bold">Actividad (Infinitivo)</th>
                                        <th class="p-3 text-left font-bold">Afirmación del Cliente (Ayer...)</th>
                                        <th class="p-3 text-center font-bold w-44">Tu respuesta</th>
                                    </tr>
                                </thead>
                                <tbody class="text-slate-700">
                                    <tr class="agenda-auditor-row border-b border-slate-100" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">08:00</td>
                                        <td class="p-3">Desayunar con un socio</td>
                                        <td class="p-3"><em>"Yo no desayuné con nadie."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="agenda-auditor-row border-b border-slate-100" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">09:30</td>
                                        <td class="p-3">Escribir el informe legal</td>
                                        <td class="p-3"><em>"Yo escribí un poema."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="agenda-auditor-row border-b border-slate-100" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">11:00</td>
                                        <td class="p-3">Llamar a la oficina</td>
                                        <td class="p-3"><em>"Nosotros llamamos al banco."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="agenda-auditor-row border-b border-slate-100" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">13:00</td>
                                        <td class="p-3">Comer sushi</td>
                                        <td class="p-3"><em>"Yo comí una hamburguesa."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="agenda-auditor-row border-b border-slate-100" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">15:00</td>
                                        <td class="p-3">Vender las acciones</td>
                                        <td class="p-3"><em>"Ella vendió su carro."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="agenda-auditor-row border-b border-slate-100" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">16:30</td>
                                        <td class="p-3">Recibir el paquete</td>
                                        <td class="p-3"><em>"Ustedes recibieron flores."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="agenda-auditor-row border-b border-slate-100" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">18:00</td>
                                        <td class="p-3">Subir los archivos</td>
                                        <td class="p-3"><em>"Yo no subí nada a la nube."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="agenda-auditor-row" data-correct="negar">
                                        <td class="p-3 font-mono text-amber-700 font-bold">20:00</td>
                                        <td class="p-3">Discutir el contrato</td>
                                        <td class="p-3"><em>"Nosotros discutimos la película."</em></td>
                                        <td class="p-2 text-center">
                                            <div class="flex flex-wrap justify-center gap-1">
                                                <button type="button" class="agenda-auditor-btn btn-confirmar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✓ Confirmar</button>
                                                <button type="button" class="agenda-auditor-btn btn-negar px-2 py-1.5 rounded-lg border-2 border-slate-300 bg-white text-slate-600 text-xs font-bold">✗ Negar</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="p-3 bg-slate-50 border-t border-slate-200 flex flex-wrap items-center justify-center gap-3">
                            <button type="button" id="btn-verificar-agenda-auditor" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-5 rounded-xl shadow-md transition flex items-center gap-2">
                                <i class="fas fa-check-double"></i> Verificar respuestas
                            </button>
                            <span id="agenda-auditor-result" class="text-sm font-semibold text-slate-600"></span>
                        </div>
                    </div>
                </div>
                <script>
                (function() {
                    var section = document.getElementById('juego-1-agenda-auditor');
                    if (!section) return;
                    var table = section.querySelector('.agenda-auditor-table');
                    var btnVerify = document.getElementById('btn-verificar-agenda-auditor');
                    var resultEl = document.getElementById('agenda-auditor-result');

                    section.querySelectorAll('.agenda-auditor-row').forEach(function(row) {
                        var btns = row.querySelectorAll('.agenda-auditor-btn');
                        btns.forEach(function(btn) {
                            btn.addEventListener('click', function() {
                                var isConfirmar = btn.classList.contains('btn-confirmar');
                                btns.forEach(function(b) { b.classList.remove('selected'); });
                                btn.classList.add('selected');
                                row.setAttribute('data-user', isConfirmar ? 'confirmar' : 'negar');
                            });
                        });
                    });

                    if (btnVerify) btnVerify.addEventListener('click', function() {
                        var rows = section.querySelectorAll('.agenda-auditor-row');
                        var correctCount = 0;
                        rows.forEach(function(row) {
                            row.classList.remove('correct', 'incorrect');
                            var correct = (row.getAttribute('data-correct') || '').toLowerCase();
                            var user = (row.getAttribute('data-user') || '').toLowerCase();
                            if (user) {
                                var ok = user === correct;
                                if (ok) correctCount++;
                                row.classList.add(ok ? 'correct' : 'incorrect');
                            }
                        });
                        var total = rows.length;
                        resultEl.textContent = total ? 'Resultado: ' + correctCount + ' / ' + total + ' correctas.' : '';
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 3: Juego 2 — Evidence & Reading ========== -->
            <section id="juego-2-evidence-reading">
                <style>
                    #juego-2-evidence-reading .reading-card { border-left: 4px solid #059669; }
                    #juego-2-evidence-reading .reading-q.correct { background: #f0fdf4 !important; border-left-color: #16a34a !important; }
                    #juego-2-evidence-reading .reading-q.incorrect { background: #fef2f2 !important; border-left-color: #dc2626 !important; }
                    #juego-2-evidence-reading .reading-feedback { opacity: 0; max-height: 0; overflow: hidden; transition: all 0.35s ease; font-size: 0.85rem; }
                    #juego-2-evidence-reading .reading-feedback.visible { opacity: 1; max-height: 4em; margin-top: 0.35rem; color: #059669; font-weight: 600; }
                    #juego-2-evidence-reading .reading-feedback.visible.incorrect { color: #dc2626; }
                </style>
                <div class="slide-container h-full flex flex-col justify-start">
                    <!-- Encabezado -->
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                        <span class="bg-emerald-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Juego 2</span>
                        <span class="bg-slate-100 text-emerald-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Lectura + Preguntas</span>
                        <div class="flex items-center gap-3 ml-auto">
                            <div class="bg-emerald-600 text-white p-3 rounded-xl shadow-lg">
                                <i class="fas fa-file-alt text-2xl text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl md:text-3xl font-black text-slate-800 m-0 leading-tight">Evidence & Reading</h2>
                                <p class="text-slate-600 text-sm font-semibold mt-0.5">Lee el texto y responde según lo leído. Los verbos en pasado te dan pistas.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Instrucciones -->
                    <div class="bg-emerald-50 border-l-4 border-emerald-500 rounded-r-xl p-3 mb-3 shadow-sm">
                        <p class="text-slate-700 text-sm m-0 font-medium"><i class="fas fa-info-circle text-emerald-600 mr-1"></i> Lee el texto abajo y luego responde las 4 preguntas. Pulsa <strong>Verificar respuestas</strong> al terminar.</p>
                    </div>

                    <!-- 1. TEXTO (lo más importante, primero y bien legible) -->
                    <div class="bg-white rounded-2xl shadow-xl border-t-8 border-emerald-500 p-6 mb-5 reading-card">
                        <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-2 py-1 rounded uppercase tracking-wider">Texto</span>
                        <h3 class="text-emerald-800 font-bold text-2xl mt-2 mb-4 border-b-2 border-emerald-100 pb-2">Un Lunes de Éxito</h3>
                        <p class="text-slate-800 text-lg leading-relaxed font-medium" style="min-height: 4em;">"El lunes, mi equipo <strong class="text-emerald-700">completó</strong> el proyecto a tiempo. Yo <strong class="text-emerald-700">revisé</strong> cada cláusula del contrato y mi secretaria <strong class="text-emerald-700">imprimió</strong> los documentos finales. A mediodía, nosotros <strong class="text-emerald-700">almorzamos</strong> con los inversores en el club. Ellos <strong class="text-emerald-700">firmaron</strong> el acuerdo sin dudar. Por la tarde, yo <strong class="text-emerald-700">respondí</strong> cincuenta correos y <strong class="text-emerald-700">decidí</strong> cerrar la oficina temprano. Finalmente, mi socio <strong class="text-emerald-700">compró</strong> una botella de vino para celebrar."</p>
                    </div>

                    <!-- 2. PREGUNTAS (solo 4, después del texto) -->
                    <div class="flex items-center gap-2 mb-3">
                        <i class="fas fa-question-circle text-emerald-600 text-lg"></i>
                        <span class="font-bold text-slate-800 text-lg">Responde según el texto</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="reading-q bg-white p-4 rounded-xl border-l-4 border-amber-400 shadow-md transition reading-q-1">
                            <span class="text-xs font-bold text-amber-600 uppercase tracking-wider">Pregunta 1</span>
                            <p class="text-base font-bold text-slate-700 mt-1 mb-2">¿Quién revisó las cláusulas?</p>
                            <input type="text" class="clean-input w-full text-base p-2.5 border-2 border-slate-200 rounded-lg" placeholder="Escribe tu respuesta..." data-correct="yo">
                            <div class="reading-feedback"></div>
                        </div>
                        <div class="reading-q bg-white p-4 rounded-xl border-l-4 border-amber-400 shadow-md transition reading-q-2">
                            <span class="text-xs font-bold text-amber-600 uppercase tracking-wider">Pregunta 2</span>
                            <p class="text-base font-bold text-slate-700 mt-1 mb-2">¿Qué imprimió la secretaria?</p>
                            <input type="text" class="clean-input w-full text-base p-2.5 border-2 border-slate-200 rounded-lg" placeholder="Escribe tu respuesta..." data-correct="los documentos finales|los documentos">
                            <div class="reading-feedback"></div>
                        </div>
                        <div class="reading-q bg-white p-4 rounded-xl border-l-4 border-amber-400 shadow-md transition reading-q-3">
                            <span class="text-xs font-bold text-amber-600 uppercase tracking-wider">Pregunta 3</span>
                            <p class="text-base font-bold text-slate-700 mt-1 mb-2">¿Dónde almorzamos nosotros?</p>
                            <input type="text" class="clean-input w-full text-base p-2.5 border-2 border-slate-200 rounded-lg" placeholder="Escribe tu respuesta..." data-correct="en el club">
                            <div class="reading-feedback"></div>
                        </div>
                        <div class="reading-q bg-white p-4 rounded-xl border-l-4 border-emerald-500 shadow-md transition reading-q-4">
                            <span class="text-xs font-bold text-emerald-600 uppercase tracking-wider">Pregunta 4</span>
                            <p class="text-base font-bold text-slate-700 mt-1 mb-2">¿Qué firmaron los inversores?</p>
                            <input type="text" class="clean-input w-full text-base p-2.5 border-2 border-slate-200 rounded-lg" placeholder="Escribe tu respuesta..." data-correct="el acuerdo">
                            <div class="reading-feedback"></div>
                        </div>
                    </div>

                    <!-- Botón Check + resultado -->
                    <div class="flex flex-wrap items-center justify-center gap-4 py-4 bg-slate-50 rounded-xl border-2 border-slate-200">
                        <button type="button" id="btn-verificar-reading" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition flex items-center gap-2 text-lg">
                            <i class="fas fa-check-double"></i> Verificar respuestas
                        </button>
                        <span id="reading-result" class="text-base font-semibold text-slate-600"></span>
                    </div>
                </div>
                <script>
                (function() {
                    function normalize(s) {
                        if (!s || typeof s !== 'string') return '';
                        return s.trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/\s+/g, ' ');
                    }
                    function matches(user, correct) {
                        var u = normalize(user);
                        var c = normalize(correct);
                        if (u === c) return true;
                        var opts = c.split('|');
                        for (var i = 0; i < opts.length; i++) if (u === normalize(opts[i])) return true;
                        if ((c.indexOf('cincuenta') !== -1 || c === '50') && (u === '50' || u === 'cincuenta')) return true;
                        if (c === 'en el club' && (u.indexOf('club') !== -1 || u === 'el club')) return true;
                        if (c === 'celebrar' && (u.indexOf('celebr') !== -1 || u.indexOf('acuerdo') !== -1 || u.indexOf('exito') !== -1)) return true;
                        return false;
                    }
                    var section = document.getElementById('juego-2-evidence-reading');
                    if (!section) return;
                    var btn = document.getElementById('btn-verificar-reading');
                    var resultEl = document.getElementById('reading-result');
                    if (!btn) return;
                    btn.addEventListener('click', function() {
                        var cards = section.querySelectorAll('.reading-q');
                        var correctCount = 0;
                        cards.forEach(function(card) {
                            var input = card.querySelector('input[data-correct]');
                            var feedback = card.querySelector('.reading-feedback');
                            if (!input || !feedback) return;
                            card.classList.remove('correct', 'incorrect');
                            var correct = input.getAttribute('data-correct') || '';
                            var user = input.value || '';
                            var ok = matches(user, correct);
                            if (ok) correctCount++;
                            card.classList.add(ok ? 'correct' : 'incorrect');
                            feedback.textContent = ok ? '✓ Correcto.' : 'Respuesta correcta: ' + correct + '.';
                            feedback.classList.toggle('incorrect', !ok);
                            feedback.classList.add('visible');
                        });
                        resultEl.textContent = 'Resultado: ' + correctCount + ' / ' + cards.length + ' correctas.';
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 4: Juego 3 — The Time Switch (con vidas) ========== -->
            <section id="juego-3-time-switch">
                <style>
                    #juego-3-time-switch .time-switch-card.correct { background: #f0fdf4 !important; border-left-color: #16a34a !important; }
                    #juego-3-time-switch .time-switch-card.incorrect { background: #fef2f2 !important; border-left-color: #dc2626 !important; }
                    #juego-3-time-switch .time-switch-feedback { opacity: 0; max-height: 0; overflow: hidden; transition: all 0.3s ease; font-size: 0.8rem; margin-top: 0.25rem; }
                    #juego-3-time-switch .time-switch-feedback.visible { opacity: 1; max-height: 3em; color: #059669; font-weight: 600; }
                    #juego-3-time-switch .time-switch-feedback.visible.wrong { color: #dc2626; }
                    #juego-3-time-switch .time-switch-input { font-size: 1.15rem; font-weight: 600; padding: 0.6rem 0.75rem; border: 2px solid #f59e0b; border-radius: 0.5rem; background: #fffbeb; text-align: center; width: 100%; min-width: 180px; min-height: 3rem; color: #1e293b; display: block; }
                    #juego-3-time-switch .time-switch-input::placeholder { color: #94a3b8; font-weight: 500; }
                    #juego-3-time-switch .time-switch-input:focus { outline: none; border-color: #d97706; box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3); }
                    #juego-3-time-switch .time-switch-input-wrap { display: inline-block; min-width: 200px; max-width: 260px; vertical-align: middle; margin: 0 2px; }
                    #juego-3-time-switch .life-heart { transition: transform 0.2s ease; }
                    #juego-3-time-switch .life-heart.lost { opacity: 0.3; filter: grayscale(1); }
                    #juego-3-time-switch .game-over-banner { display: none; }
                    #juego-3-time-switch .game-over-banner.visible { display: flex; }
                    #juego-3-time-switch .win-banner { display: none; }
                    #juego-3-time-switch .win-banner.visible { display: flex; }
                </style>
                <div class="slide-container h-full flex flex-col justify-start">
                    <!-- Encabezado + Vidas -->
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                        <span class="bg-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Juego 3</span>
                        <span class="bg-orange-100 text-orange-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Presente → Pasado</span>
                        <div class="flex items-center gap-3 ml-auto">
                            <!-- Vidas (corazones) -->
                            <div id="time-switch-lives" class="flex items-center gap-1.5 bg-red-50 border border-red-200 rounded-full px-3 py-1.5">
                                <span class="text-xs font-bold text-slate-600 mr-1">Vidas</span>
                                <i class="fas fa-heart text-red-500 life-heart" data-life="1"></i>
                                <i class="fas fa-heart text-red-500 life-heart" data-life="2"></i>
                                <i class="fas fa-heart text-red-500 life-heart" data-life="3"></i>
                            </div>
                            <div class="bg-orange-500 text-white p-3 rounded-xl shadow-lg">
                                <i class="fas fa-exchange-alt text-2xl text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl md:text-3xl font-black text-slate-800 m-0 leading-tight">The Time Switch</h2>
                                <p class="text-slate-600 text-sm font-semibold mt-0.5">Conjuga en pretérito indefinido. Cada error te quita una vida. ¡No pierdas las 3!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Game Over / Ganaste -->
                    <div id="time-switch-game-over" class="game-over-banner items-center justify-center gap-3 bg-red-100 border-2 border-red-400 rounded-2xl p-4 mb-4">
                        <i class="fas fa-times-circle text-4xl text-red-600"></i>
                        <div>
                            <p class="font-black text-red-800 text-xl m-0">¡Perdiste!</p>
                            <p class="text-red-700 text-sm m-0 mt-0.5">Se te acabaron las vidas. Pulsa <strong>Reintentar</strong> para jugar de nuevo.</p>
                        </div>
                    </div>
                    <div id="time-switch-win" class="win-banner items-center justify-center gap-3 bg-emerald-100 border-2 border-emerald-500 rounded-2xl p-4 mb-4">
                        <i class="fas fa-trophy text-4xl text-amber-500"></i>
                        <div>
                            <p class="font-black text-emerald-800 text-xl m-0">¡Ganaste!</p>
                            <p class="text-emerald-700 text-sm m-0 mt-0.5">Todas las respuestas correctas. ¿Otra partida?</p>
                        </div>
                    </div>

                    <!-- Instrucciones -->
                    <div class="bg-orange-50 border-l-4 border-orange-500 rounded-r-xl p-3 mb-4 shadow-sm">
                        <p class="text-slate-700 text-sm m-0 font-medium"><i class="fas fa-info-circle text-orange-600 mr-1"></i> Escribe <strong>solo el verbo en pasado</strong> en cada hueco. Cada error = 1 vida menos. <strong>Verificar respuestas</strong> al terminar.</p>
                    </div>

                    <!-- Grid de ejercicios -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto flex-1 min-h-0 pb-2">
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">1</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Hoy asisto a clase</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Ayer <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="asistí"></span> a clase.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">2</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Ella vende su ropa</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Ella <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="vendió"></span> su ropa.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">3</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Nosotros subimos las escaleras</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Nosotros <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="subimos"></span> las escaleras.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">4</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Tú comprendes todo</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Tú <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="comprendiste"></span> todo.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">5</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Ellos escupen el chicle</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Ellos <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="escupieron"></span> el chicle.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">6</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Yo barro el suelo</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Yo <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="barrí"></span> el suelo.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">7</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Ustedes dibujan un mapa</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Ustedes <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="dibujaron"></span> un mapa.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-orange-400 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-orange-100 text-orange-700 text-sm font-bold items-center justify-center">8</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Él promete volver</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Él <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="prometió"></span> volver.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-amber-500 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-amber-100 text-amber-700 text-sm font-bold items-center justify-center">9</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Vosotros discutís mucho</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Vosotros <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="discutisteis"></span> mucho.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                        <div class="time-switch-card bg-white p-4 rounded-2xl border-l-4 border-amber-500 shadow-md hover:shadow-lg transition">
                            <span class="inline-flex w-8 h-8 rounded-full bg-amber-100 text-amber-700 text-sm font-bold items-center justify-center">10</span>
                            <p class="text-slate-500 text-xs font-semibold mt-2 mb-1">Presente</p>
                            <p class="text-slate-800 font-bold text-sm mb-2">Yo añado sal</p>
                            <p class="text-slate-700 text-sm font-medium mb-2">Pasado: Yo <span class="time-switch-input-wrap"><input type="text" class="clean-input time-switch-input" placeholder="verbo en pasado" data-correct="añadí"></span> sal.</p>
                            <div class="time-switch-feedback"></div>
                        </div>
                    </div>

                    <!-- Botón Verificar + Reintentar + resultado -->
                    <div class="pt-3 pb-1 flex flex-wrap items-center justify-center gap-3 bg-slate-50 rounded-xl border border-slate-100 mt-2">
                        <button type="button" id="btn-verificar-time-switch" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2.5 px-6 rounded-xl shadow-lg transition flex items-center gap-2">
                            <i class="fas fa-check-double"></i> Verificar respuestas
                        </button>
                        <button type="button" id="btn-reintentar-time-switch" class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2.5 px-5 rounded-xl shadow-lg transition flex items-center gap-2" style="display: none;">
                            <i class="fas fa-redo"></i> Reintentar
                        </button>
                        <span id="time-switch-result" class="text-sm font-semibold text-slate-600"></span>
                    </div>
                </div>
                <script>
                (function() {
                    function normalize(s) {
                        if (!s || typeof s !== 'string') return '';
                        return s.trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/\s+/g, ' ');
                    }
                    var section = document.getElementById('juego-3-time-switch');
                    if (!section) return;
                    var btn = document.getElementById('btn-verificar-time-switch');
                    var btnRetry = document.getElementById('btn-reintentar-time-switch');
                    var resultEl = document.getElementById('time-switch-result');
                    var gameOverEl = document.getElementById('time-switch-game-over');
                    var winEl = document.getElementById('time-switch-win');
                    var livesContainer = document.getElementById('time-switch-lives');
                    var hearts = section.querySelectorAll('.life-heart');
                    var TOTAL_LIVES = 3;
                    var lives = TOTAL_LIVES;

                    function updateLivesUI() {
                        hearts.forEach(function(h, i) {
                            if (i < lives) {
                                h.classList.remove('lost');
                            } else {
                                h.classList.add('lost');
                            }
                        });
                    }

                    function resetGame() {
                        lives = TOTAL_LIVES;
                        updateLivesUI();
                        gameOverEl.classList.remove('visible');
                        winEl.classList.remove('visible');
                        btn.style.display = '';
                        btn.disabled = false;
                        if (btnRetry) {
                            btnRetry.style.display = 'none';
                            btnRetry.innerHTML = '<i class="fas fa-redo"></i> Reintentar';
                        }
                        resultEl.textContent = '';
                        var cards = section.querySelectorAll('.time-switch-card');
                        cards.forEach(function(card) {
                            card.classList.remove('correct', 'incorrect');
                            var input = card.querySelector('input[data-correct]');
                            var feedback = card.querySelector('.time-switch-feedback');
                            if (input) input.value = '';
                            if (feedback) {
                                feedback.textContent = '';
                                feedback.classList.remove('visible', 'wrong');
                            }
                        });
                    }

                    if (btnRetry) btnRetry.addEventListener('click', resetGame);

                    if (!btn) return;
                    btn.addEventListener('click', function() {
                        if (lives <= 0) return;
                        var cards = section.querySelectorAll('.time-switch-card');
                        var correctCount = 0;
                        cards.forEach(function(card) {
                            var input = card.querySelector('input[data-correct]');
                            var feedback = card.querySelector('.time-switch-feedback');
                            if (!input || !feedback) return;
                            card.classList.remove('correct', 'incorrect');
                            var correct = normalize(input.getAttribute('data-correct') || '');
                            var user = normalize(input.value || '');
                            var ok = user === correct;
                            if (ok) correctCount++;
                            card.classList.add(ok ? 'correct' : 'incorrect');
                            feedback.textContent = ok ? '✓ Correcto.' : 'Correcto: ' + (input.getAttribute('data-correct') || '');
                            feedback.classList.toggle('wrong', !ok);
                            feedback.classList.add('visible');
                        });
                        var wrongCount = cards.length - correctCount;
                        lives = Math.max(0, lives - wrongCount);
                        updateLivesUI();
                        resultEl.textContent = correctCount + ' / ' + cards.length + ' correctas. ' + (wrongCount ? wrongCount + ' error(es) = -' + Math.min(wrongCount, lives + wrongCount) + ' vida(s).' : '');

                        if (lives <= 0) {
                            gameOverEl.classList.add('visible');
                            btn.style.display = 'none';
                            btn.disabled = true;
                            if (btnRetry) btnRetry.style.display = 'inline-flex';
                            resultEl.textContent = '¡Se acabaron las vidas! Pulsa Reintentar.';
                        } else if (correctCount === cards.length) {
                            winEl.classList.add('visible');
                            btn.style.display = 'none';
                            if (btnRetry) btnRetry.style.display = 'inline-flex';
                            btnRetry.textContent = '';
                            btnRetry.innerHTML = '<i class="fas fa-redo"></i> Jugar de nuevo';
                            resultEl.textContent = '¡Perfecto! ' + correctCount + ' / ' + cards.length;
                        }
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 5: Juego 4 — Logic Match (emparejar interactivo) ========== -->
            <section id="juego-4-logic-match">
                <style>
                    #juego-4-logic-match .match-verb { cursor: pointer; user-select: none; }
                    #juego-4-logic-match .match-verb.selected { box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.5); background: #f5f3ff !important; }
                    #juego-4-logic-match .match-verb.paired { border-left-width: 6px; }
                    #juego-4-logic-match .match-verb.correct { background: #f0fdf4 !important; border-left-color: #16a34a !important; }
                    #juego-4-logic-match .match-verb.incorrect { background: #fef2f2 !important; border-left-color: #dc2626 !important; }
                    #juego-4-logic-match .match-comp { cursor: pointer; user-select: none; }
                    #juego-4-logic-match .match-comp.selected { box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.6); background: #fffbeb !important; }
                    #juego-4-logic-match .match-comp.paired { border-width: 2px; border-color: #d97706; }
                    #juego-4-logic-match .match-comp.correct { background: #f0fdf4 !important; border-color: #16a34a !important; }
                    #juego-4-logic-match .match-comp.incorrect { background: #fef2f2 !important; border-color: #dc2626 !important; }
                    #juego-4-logic-match .match-badge { font-size: 1.2rem; font-weight: 900; color: #78350f; min-width: 2.5rem; text-align: center; padding: 0.2rem 0.4rem; border-radius: 0.5rem; background: #fef3c7; border: 1px solid #f59e0b; }
                </style>
                <div class="slide-container h-full flex flex-col justify-start">
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                        <span class="bg-purple-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Juego 4</span>
                        <span class="bg-purple-100 text-purple-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Emparejar</span>
                        <div class="flex items-center gap-3 ml-auto">
                            <div class="bg-purple-600 text-white p-3 rounded-xl shadow-lg">
                                <i class="fas fa-puzzle-piece text-2xl text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl md:text-3xl font-black text-slate-800 m-0 leading-tight">Logic Match</h2>
                                <p class="text-slate-600 text-sm font-semibold mt-0.5">Une cada verbo (izquierda) con su complemento lógico (derecha).</p>
                            </div>
                        </div>
                    </div>

                    <!-- Instrucciones -->
                    <div class="bg-purple-50 border-l-4 border-purple-500 rounded-r-xl p-3 mb-4 shadow-sm">
                        <p class="text-slate-700 text-sm m-0 font-medium"><i class="fas fa-hand-pointer text-purple-600 mr-1"></i> Clic en un verbo (izquierda), luego en su complemento (derecha). Forma los 8 pares y pulsa <strong>Verificar respuestas</strong>.</p>
                    </div>

                    <!-- Barra de estado de pares -->
                    <div id="logic-match-status" class="mb-3 px-4 py-2 bg-slate-100 rounded-xl text-sm font-medium text-slate-600 flex flex-wrap items-center gap-2">
                        <span>Pares:</span>
                        <span id="logic-match-pairs-text">Ninguno aún. Elige un verbo y luego su complemento.</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto flex-1 min-h-0">
                        <!-- Columna verbos (izquierda) -->
                        <div class="space-y-2">
                            <p class="text-xs font-bold text-purple-600 uppercase tracking-wider mb-2">Verbos (haz clic primero aquí)</p>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-1" data-num="1" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">1</span>
                                <strong class="text-slate-700 flex-1">Yo abrí...</strong>
                                <span class="match-badge match-pair-1"></span>
                            </div>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-2" data-num="2" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">2</span>
                                <strong class="text-slate-700 flex-1">Tú caminaste...</strong>
                                <span class="match-badge match-pair-2"></span>
                            </div>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-3" data-num="3" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">3</span>
                                <strong class="text-slate-700 flex-1">Él perdió...</strong>
                                <span class="match-badge match-pair-3"></span>
                            </div>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-4" data-num="4" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">4</span>
                                <strong class="text-slate-700 flex-1">Nosotros subimos...</strong>
                                <span class="match-badge match-pair-4"></span>
                            </div>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-5" data-num="5" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">5</span>
                                <strong class="text-slate-700 flex-1">Ellos cocinaron...</strong>
                                <span class="match-badge match-pair-5"></span>
                            </div>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-6" data-num="6" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">6</span>
                                <strong class="text-slate-700 flex-1">Ustedes aprendieron...</strong>
                                <span class="match-badge match-pair-6"></span>
                            </div>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-7" data-num="7" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">7</span>
                                <strong class="text-slate-700 flex-1">Ella escribió...</strong>
                                <span class="match-badge match-pair-7"></span>
                            </div>
                            <div class="match-verb bg-white p-3 rounded-xl border-l-4 border-purple-400 shadow-sm hover:shadow-md transition flex items-center gap-3 match-verb-8" data-num="8" role="button" tabindex="0">
                                <span class="bg-purple-100 text-purple-700 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">8</span>
                                <strong class="text-slate-700 flex-1">Yo respondí...</strong>
                                <span class="match-badge match-pair-8"></span>
                            </div>
                        </div>
                        <!-- Columna complementos (derecha) -->
                        <div class="space-y-2">
                            <p class="text-xs font-bold text-amber-700 uppercase tracking-wider mb-2">Complementos (luego clic aquí)</p>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="A"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">A</span><span class="text-slate-700">...el monte Everest.</span></div>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="B"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">B</span><span class="text-slate-700">...las llaves de casa.</span></div>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="C"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">C</span><span class="text-slate-700">...la ventana por el calor.</span></div>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="D"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">D</span><span class="text-slate-700">...la cena para su novia.</span></div>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="E"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">E</span><span class="text-slate-700">...por el parque 2 horas.</span></div>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="F"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">F</span><span class="text-slate-700">...un correo importante.</span></div>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="G"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">G</span><span class="text-slate-700">...mucho español hoy.</span></div>
                            <div class="match-comp bg-amber-50 p-3 rounded-xl border-2 border-amber-200 shadow-sm hover:shadow-md transition flex items-center gap-3" data-letter="H"><span class="bg-amber-200 text-amber-900 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">H</span><span class="text-slate-700">...todas las dudas.</span></div>
                        </div>
                    </div>

                    <div class="pt-3 pb-1 flex flex-wrap items-center justify-center gap-3 bg-slate-50 rounded-xl border border-slate-100 mt-3">
                        <button type="button" id="btn-verificar-logic-match" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2.5 px-6 rounded-xl shadow-lg transition flex items-center gap-2">
                            <i class="fas fa-check-double"></i> Verificar respuestas
                        </button>
                        <span id="logic-match-result" class="text-sm font-semibold text-slate-600"></span>
                    </div>
                </div>
                <script>
                (function() {
                    var section = document.getElementById('juego-4-logic-match');
                    if (!section) return;
                    var correctPairs = { '1':'C','2':'E','3':'B','4':'A','5':'D','6':'G','7':'F','8':'H' };
                    var pairs = {}; // num -> letter
                    var selectedVerb = null;
                    var verbs = section.querySelectorAll('.match-verb');
                    var comps = section.querySelectorAll('.match-comp');
                    var pairsText = document.getElementById('logic-match-pairs-text');
                    var btn = document.getElementById('btn-verificar-logic-match');
                    var resultEl = document.getElementById('logic-match-result');

                    function updatePairBadges() {
                        verbs.forEach(function(v) {
                            var num = v.getAttribute('data-num');
                            var badge = v.querySelector('.match-badge');
                            if (pairs[num] && badge) {
                                badge.textContent = '→ ' + pairs[num];
                                v.classList.add('paired');
                            } else {
                                if (badge) badge.textContent = '';
                                v.classList.remove('paired');
                            }
                        });
                        var arr = [];
                        for (var n = 1; n <= 8; n++) arr.push(n + '→' + (pairs[n] || '?'));
                        if (pairsText) pairsText.textContent = arr.join('  ·  ') + (Object.keys(pairs).length === 8 ? ' — Listo para verificar.' : '');
                    }

                    function clearSelection() {
                        selectedVerb = null;
                        verbs.forEach(function(v) { v.classList.remove('selected'); });
                        comps.forEach(function(c) { c.classList.remove('selected'); });
                    }

                    verbs.forEach(function(v) {
                        v.addEventListener('click', function() {
                            var num = this.getAttribute('data-num');
                            clearSelection();
                            this.classList.add('selected');
                            selectedVerb = num;
                        });
                    });

                    comps.forEach(function(c) {
                        c.addEventListener('click', function() {
                            var letter = this.getAttribute('data-letter');
                            if (!selectedVerb) return;
                            pairs[selectedVerb] = letter;
                            updatePairBadges();
                            clearSelection();
                        });
                    });

                    if (btn) btn.addEventListener('click', function() {
                        var correctCount = 0;
                        verbs.forEach(function(v) {
                            v.classList.remove('correct', 'incorrect');
                            var num = v.getAttribute('data-num');
                            var expected = correctPairs[num];
                            var actual = pairs[num];
                            if (actual) {
                                var ok = actual === expected;
                                if (ok) correctCount++;
                                v.classList.add(ok ? 'correct' : 'incorrect');
                            }
                        });
                        comps.forEach(function(c) {
                            c.classList.remove('correct', 'incorrect');
                            var letter = c.getAttribute('data-letter');
                            var matchedNum = null;
                            for (var k in pairs) { if (pairs[k] === letter) { matchedNum = k; break; } }
                            if (matchedNum) {
                                var ok = correctPairs[matchedNum] === letter;
                                c.classList.add(ok ? 'correct' : 'incorrect');
                            }
                        });
                        resultEl.textContent = 'Resultado: ' + correctCount + ' / 8 correctas.';
                        if (correctCount > 0 && typeof confetti === 'function') {
                            confetti({ particleCount: 40, spread: 60, origin: { y: 0.7 }, colors: ['#16a34a', '#f59e0b', '#7c3aed'], zIndex: 8000 });
                            if (typeof playSound === 'function') try { playSound('confetti'); } catch (e) {}
                        }
                        var totalPaired = Object.keys(pairs).length;
                        if (totalPaired > 0 && correctCount < totalPaired && typeof playSound === 'function') {
                            try { playSound('error'); } catch (e) {}
                        }
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 6: Juego 5 — The Error Debugger ========== -->
            <section id="juego-5-error-debugger">
                <style>
                    #juego-5-error-debugger .debugger-word { cursor: pointer; border-radius: 4px; transition: background 0.2s, color 0.2s; padding: 0 2px; }
                    #juego-5-error-debugger .debugger-word:hover { background: rgba(254, 202, 202, 0.6); }
                    #juego-5-error-debugger .debugger-word.fixed { background: #bbf7d0 !important; color: #166534; font-weight: 700; cursor: default; }
                    #juego-5-error-debugger .debugger-text-block { font-size: 1.35rem; line-height: 1.65; color: #1e293b; font-weight: 500; }
                </style>
                <div class="slide-container h-full flex flex-col justify-start">
                    <div class="flex flex-wrap items-center gap-3 mb-2">
                        <span class="bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Juego 5</span>
                        <span class="bg-red-100 text-red-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Encontrar 8 errores</span>
                        <div class="flex items-center gap-2 ml-auto">
                            <div id="debugger-timer" class="flex items-center gap-1.5 bg-slate-800 text-white px-3 py-1.5 rounded-lg font-mono text-sm font-bold">
                                <i class="fas fa-stopwatch text-amber-400"></i>
                                <span id="debugger-time-display">0:00</span>
                            </div>
                            <div id="debugger-count" class="bg-red-100 border-2 border-red-400 rounded-lg px-3 py-1.5 text-center">
                                <span class="text-[10px] font-bold text-red-600 uppercase">Encontrados</span>
                                <p class="text-lg font-black text-red-700 m-0 leading-none"><span id="debugger-count-num">0</span>/8</p>
                            </div>
                        </div>
                    </div>
                    <p class="text-slate-600 text-sm mb-3"><i class="fas fa-mouse-pointer text-red-500 mr-1"></i> Haz clic en cada palabra mal conjugada para corregirla. ¡Verás confeti en cada acierto!</p>

                    <!-- TEXTO COMO PROTAGONISTA: grande y legible -->
                    <div class="bg-white rounded-2xl shadow-xl border-t-8 border-red-500 p-6 flex-1 overflow-y-auto min-h-0">
                        <p class="debugger-text-block mb-0">
                            Las tardes en casa de la abuela son especiales y dejan recuerdos que no se olvidan. Lo que sigue es un día que quedó guardado en la memoria.
                            <br><br>
                            "Ayer yo <span class="debugger-word" data-correct="comí">comió</span> con mi abuela en su casa. Nosotros <span class="debugger-word" data-correct="hablamos">hablaron</span> mucho sobre el pasado y sobre cómo era la vida antes. Ella me <span class="debugger-word" data-correct="contó">contaste</span> historias de su niñez que yo no conocía. Después de comer, yo <span class="debugger-word" data-correct="limpié">limpiaste</span> la mesa y mi abuela bebió un té (¡ese está bien!). Más tarde, mis primos <span class="debugger-word" data-correct="llegaron">llegaste</span> y todos <span class="debugger-word" data-correct="bailamos">bailasteis</span> en la sala hasta muy noche. La música sonó fuerte y nos reímos mucho. Yo <span class="debugger-word" data-correct="decidí">decidió</span> irme a las diez porque trabajé mucho <span class="debugger-word" data-correct="ayer">hoy</span> y estaba cansado. Fue un día inolvidable."
                        </p>
                    </div>
                </div>
                <script>
                (function() {
                    var section = document.getElementById('juego-5-error-debugger');
                    if (!section) return;
                    var timerDisplay = document.getElementById('debugger-time-display');
                    var countNum = document.getElementById('debugger-count-num');
                    var words = section.querySelectorAll('.debugger-word');
                    var total = words.length;
                    var found = 0;
                    var timerInterval = null;
                    var seconds = 0;
                    var started = false;

                    function startTimer() {
                        if (started) return;
                        started = true;
                        timerInterval = setInterval(function() {
                            seconds++;
                            var m = Math.floor(seconds / 60);
                            var s = seconds % 60;
                            if (timerDisplay) timerDisplay.textContent = m + ':' + (s < 10 ? '0' : '') + s;
                        }, 1000);
                    }

                    function fireConfetti() {
                        var fn = typeof confetti !== 'undefined' ? confetti : (window.confetti || null);
                        if (fn) {
                            try {
                                fn({ particleCount: 80, spread: 75, origin: { y: 0.6 }, colors: ['#ef4444', '#f59e0b', '#22c55e'], zIndex: 9999 });
                                fn({ particleCount: 40, spread: 100, origin: { y: 0.5, x: 0.3 }, colors: ['#f59e0b'], zIndex: 9999 });
                                fn({ particleCount: 40, spread: 100, origin: { y: 0.5, x: 0.7 }, colors: ['#22c55e'], zIndex: 9999 });
                            } catch (e) {}
                        }
                        if (typeof playSound === 'function') { try { playSound('confetti'); } catch (e) {} }
                    }

                    words.forEach(function(el) {
                        el.addEventListener('click', function() {
                            if (this.classList.contains('fixed')) return;
                            startTimer();
                            var correct = this.getAttribute('data-correct');
                            if (!correct) return;
                            this.textContent = correct;
                            this.classList.add('fixed');
                            found++;
                            if (countNum) countNum.textContent = found;
                            fireConfetti();
                            if (found === total && typeof react === 'function') {
                                try { react('confetti'); } catch (e) {}
                            }
                        });
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 7: Juego 6 — The Scriptwriter ========== -->
            <section id="juego-6-scriptwriter">
                <style>
                    #juego-6-scriptwriter .scriptwriter-story { font-size: 1.35rem; line-height: 1.7; color: #1e293b; font-weight: 500; }
                    #juego-6-scriptwriter .scriptwriter-story .scriptwriter-input { font-size: 1.2rem; min-width: 140px; border-bottom: 2px solid #6366f1; border-radius: 4px; padding: 4px 8px; font-weight: 600; color: #4338ca; }
                    #juego-6-scriptwriter .scriptwriter-input.correct { border-color: #16a34a; background: #f0fdf4; color: #166534; }
                    #juego-6-scriptwriter .scriptwriter-input.incorrect { border-color: #dc2626; background: #fef2f2; color: #b91c1c; }
                </style>
                <div class="slide-container h-full flex flex-col justify-start">
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                        <span class="bg-indigo-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Juego 6</span>
                        <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Completar historia</span>
                        <div class="flex items-center gap-3 ml-auto">
                            <div class="bg-indigo-600 text-white p-3 rounded-xl shadow-lg">
                                <i class="fas fa-film text-2xl text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl md:text-3xl font-black text-slate-800 m-0 leading-tight">The Scriptwriter</h2>
                                <p class="text-slate-600 text-sm font-semibold mt-0.5">Completa la historia con el verbo correcto en pasado (pretérito indefinido).</p>
                            </div>
                        </div>
                    </div>

                    <!-- Instrucciones -->
                    <div class="bg-indigo-50 border-l-4 border-indigo-500 rounded-r-xl p-3 mb-3 shadow-sm">
                        <p class="text-slate-700 text-sm m-0 font-medium"><i class="fas fa-pen-fancy text-indigo-600 mr-1"></i> Usa cada verbo <strong>una vez</strong> en pasado. Luego <strong>Verificar respuestas</strong>.</p>
                    </div>

                    <!-- Banco de verbos (mejor diseño) -->
                    <div class="mb-4 p-4 bg-white rounded-2xl shadow-md border-2 border-indigo-100">
                        <p class="text-xs font-bold text-indigo-600 uppercase tracking-wider mb-2">Banco de verbos (úsalos en pasado)</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">descubrir</span>
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">aprender</span>
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">recibir</span>
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">abrir</span>
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">responder</span>
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">correr</span>
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">subir</span>
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-lg text-sm font-semibold">vivir</span>
                        </div>
                    </div>

                    <!-- Historia: las frases son lo principal, texto grande y legible -->
                    <div class="bg-white rounded-2xl shadow-xl border-t-8 border-indigo-500 p-6 flex-1 overflow-y-auto">
                        <p class="scriptwriter-story mb-0">
                            <strong class="text-indigo-700">El mapa del tesoro</strong><br><br>
                            El año pasado, yo <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="viví"> en una ciudad pequeña cerca de las montañas. Una mañana de sábado, de repente, <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="recibí"> un paquete misterioso en mi puerta. No había remitente. Con las manos temblorosas, yo <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="abrí"> la caja con mucho cuidado. Dentro, <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="descubrí"> un mapa del tesoro antiguo y una nota que decía: "Sigue las señales." No lo pensé dos veces. Yo <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="corrí"> hacia la montaña más cercana. <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="subí"> por el sendero hasta la cima bajo un sol fuerte. Allí, <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="aprendí"> a leer las señales del mapa con paciencia. Pero cuando quise avisar a mi familia, ¡nadie me <input type="text" class="clean-input scriptwriter-input" placeholder="verbo en pasado" data-correct="respondió"> cuando llamé por teléfono! Al final, esa aventura se convirtió en el mejor recuerdo del año.
                        </p>
                        <div class="mt-4 pt-3 border-t border-slate-200 flex flex-wrap items-center justify-center gap-3">
                            <button type="button" id="btn-verificar-scriptwriter" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-5 rounded-xl shadow-md transition flex items-center gap-2">
                                <i class="fas fa-check-double"></i> Verificar respuestas
                            </button>
                            <span id="scriptwriter-result" class="text-sm font-semibold text-slate-600"></span>
                        </div>
                    </div>
                </div>
                <script>
                (function() {
                    function normalize(s) {
                        if (!s || typeof s !== 'string') return '';
                        return s.trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/\s+/g, ' ');
                    }
                    var section = document.getElementById('juego-6-scriptwriter');
                    if (!section) return;
                    var btn = document.getElementById('btn-verificar-scriptwriter');
                    var resultEl = document.getElementById('scriptwriter-result');
                    if (!btn) return;
                    btn.addEventListener('click', function() {
                        var inputs = section.querySelectorAll('.scriptwriter-input[data-correct]');
                        var correctCount = 0;
                        inputs.forEach(function(inp) {
                            inp.classList.remove('correct', 'incorrect');
                            var correct = normalize(inp.getAttribute('data-correct') || '');
                            var user = normalize(inp.value || '');
                            var ok = user === correct;
                            if (ok) correctCount++;
                            inp.classList.add(ok ? 'correct' : 'incorrect');
                        });
                        resultEl.textContent = 'Resultado: ' + correctCount + ' / ' + inputs.length + ' correctas.';
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 8: Juego 7 — Chronological Order ========== -->
            <section id="juego-7-chronological">
                <style>
                    #juego-7-chronological .chrono-row.correct { background: #f0fdf4 !important; border-left-color: #16a34a !important; }
                    #juego-7-chronological .chrono-row.incorrect { background: #fef2f2 !important; border-left-color: #dc2626 !important; }
                    #juego-7-chronological .connector-btn { padding: 6px 10px; font-size: 0.8rem; border-radius: 8px; border: 2px solid #94a3b8; background: #fff; color: #334155; font-weight: 600; cursor: pointer; transition: all 0.2s; }
                    #juego-7-chronological .connector-btn:hover { border-color: #0d9488; background: #f0fdfa; color: #0f766e; }
                    #juego-7-chronological .connector-btn.active { border-color: #0d9488; background: #0d9488; color: #fff; }
                    #juego-7-chronological .chrono-row .chrono-connector-wrap { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
                    #juego-7-chronological .chrono-phrase { font-size: 1.05rem; color: #1e293b; font-weight: 500; }
                </style>
                <div class="slide-container h-full flex flex-col justify-start">
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                        <span class="bg-teal-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Juego 7</span>
                        <span class="bg-teal-100 text-teal-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Orden + Conectores</span>
                        <div class="flex items-center gap-3 ml-auto">
                            <div class="bg-teal-600 text-white p-3 rounded-xl shadow-lg">
                                <i class="fas fa-calendar-alt text-2xl text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl md:text-3xl font-black text-slate-800 m-0 leading-tight">Chronological Order</h2>
                                <p class="text-slate-600 text-sm font-semibold mt-0.5">Ordena la historia con conectores y conjuga cada verbo en pasado.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Instrucciones -->
                    <div class="bg-teal-50 border-l-4 border-teal-500 rounded-r-xl p-3 mb-3 shadow-sm">
                        <p class="text-slate-700 text-sm m-0 font-medium"><i class="fas fa-book-open text-teal-600 mr-1"></i> Orden 1→8 ya dado. Elige el <strong>conector</strong> y escribe el <strong>verbo en pasado</strong> en cada fila. Luego <strong>Verificar respuestas</strong>.</p>
                    </div>

                    <!-- Banco de conectores -->
                    <div class="mb-3 px-4 py-2 bg-white rounded-xl border-2 border-teal-100 flex flex-wrap items-center gap-2">
                        <span class="text-xs font-bold text-teal-700 uppercase tracking-wider">Conectores:</span>
                        <span class="text-sm text-slate-600">Primero, Luego, Después, Más tarde, Entonces, A continuación, Por último, Finalmente</span>
                    </div>

                    <!-- 8 filas: conector (select) + verbo (input) + resto -->
                    <div class="space-y-2 overflow-y-auto flex-1 pb-2">
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="Primero" data-verb="revisamos">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">1</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">nosotros</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">las pruebas.</span>
                        </div>
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="Luego" data-verb="escribí">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">2</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">yo</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">la demanda.</span>
                        </div>
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="Después" data-verb="presentamos">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">3</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">nosotros</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">los papeles.</span>
                        </div>
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="Más tarde" data-verb="decidió">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">4</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">el juez</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">a nuestro favor.</span>
                        </div>
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="Entonces" data-verb="llamé">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">5</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">yo</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">al cliente.</span>
                        </div>
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="A continuación" data-verb="celebramos">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">6</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">nosotros</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">en el restaurante.</span>
                        </div>
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="Por último" data-verb="recibí">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">7</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">yo</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">el pago.</span>
                        </div>
                        <div class="chrono-row bg-white p-3 rounded-xl border-l-4 border-teal-400 shadow-sm flex flex-wrap items-center gap-2" data-connector="Finalmente" data-verb="terminó">
                            <span class="bg-teal-100 text-teal-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">8</span>
                            <div class="chrono-connector-wrap">
                                <input type="hidden" class="chrono-connector" value="">
                                <button type="button" class="connector-btn" data-value="Primero">Primero</button>
                                <button type="button" class="connector-btn" data-value="Luego">Luego</button>
                                <button type="button" class="connector-btn" data-value="Después">Después</button>
                                <button type="button" class="connector-btn" data-value="Más tarde">Más tarde</button>
                                <button type="button" class="connector-btn" data-value="Entonces">Entonces</button>
                                <button type="button" class="connector-btn" data-value="A continuación">A continuación</button>
                                <button type="button" class="connector-btn" data-value="Por último">Por último</button>
                                <button type="button" class="connector-btn" data-value="Finalmente">Finalmente</button>
                            </div>
                            <span class="chrono-phrase">el caso</span>
                            <input type="text" class="chrono-verb clean-input text-sm border-b-2 border-teal-300 rounded px-2 py-1.5 w-28 font-semibold" placeholder="verbo">
                            <span class="chrono-phrase">oficialmente.</span>
                        </div>
                    </div>

                    <div class="pt-3 flex flex-wrap items-center justify-center gap-3 bg-slate-50 rounded-xl border border-slate-100 mt-2">
                        <button type="button" id="btn-verificar-chrono" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-5 rounded-xl shadow-md transition flex items-center gap-2">
                            <i class="fas fa-check-double"></i> Verificar respuestas
                        </button>
                        <span id="chrono-result" class="text-sm font-semibold text-slate-600"></span>
                    </div>
                </div>
                <script>
                (function() {
                    function normalize(s) {
                        if (!s || typeof s !== 'string') return '';
                        return s.trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/\s+/g, ' ');
                    }
                    var section = document.getElementById('juego-7-chronological');
                    if (!section) return;
                    var btn = document.getElementById('btn-verificar-chrono');
                    var resultEl = document.getElementById('chrono-result');
                    if (!btn) return;
                    section.addEventListener('click', function(e) {
                        var b = e.target.closest('.connector-btn');
                        if (!b) return;
                        var wrap = b.closest('.chrono-connector-wrap');
                        var row = b.closest('.chrono-row');
                        if (!wrap || !row) return;
                        var hidden = row.querySelector('.chrono-connector');
                        if (hidden) hidden.value = b.getAttribute('data-value') || '';
                        wrap.querySelectorAll('.connector-btn').forEach(function(btn) { btn.classList.remove('active'); });
                        b.classList.add('active');
                    });
                    btn.addEventListener('click', function() {
                        var rows = section.querySelectorAll('.chrono-row');
                        var correctCount = 0;
                        rows.forEach(function(row) {
                            row.classList.remove('correct', 'incorrect');
                            var expectedConn = row.getAttribute('data-connector') || '';
                            var expectedVerb = normalize(row.getAttribute('data-verb') || '');
                            var select = row.querySelector('.chrono-connector');
                            var input = row.querySelector('.chrono-verb');
                            var connOk = select && normalize(select.value) === normalize(expectedConn);
                            var verbOk = input && normalize(input.value) === expectedVerb;
                            var ok = connOk && verbOk;
                            if (ok) correctCount++;
                            row.classList.add(ok ? 'correct' : 'incorrect');
                        });
                        resultEl.textContent = 'Resultado: ' + correctCount + ' / ' + rows.length + ' filas correctas.';
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 9: Juego 8 — Rapid Fire (Ruleta) ========== -->
            <section id="juego-8-ruleta" data-background-color="#0f172a">
                <style>
                    #juego-8-ruleta .ruleta-bg { background: radial-gradient(ellipse at center, #1e293b 0%, #0f172a 60%); }
                    #juego-8-ruleta .ruleta-wheel { width: 280px; height: 280px; border-radius: 50%; position: relative; overflow: hidden; box-shadow: 0 0 0 8px rgba(245, 158, 11, 0.4), 0 0 40px rgba(245, 158, 11, 0.2), inset 0 0 30px rgba(0,0,0,0.3); transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.3, 1); }
                    #juego-8-ruleta .ruleta-segment { position: absolute; width: 50%; height: 50%; left: 50%; top: 0; transform-origin: left bottom; clip-path: polygon(0 0, 100% 0, 0 100%); display: flex; align-items: flex-start; justify-content: flex-start; padding-top: 12%; padding-left: 8%; font-weight: 900; font-size: 1rem; color: rgba(255,255,255,0.95); text-shadow: 0 1px 3px rgba(0,0,0,0.6); }
                    #juego-8-ruleta .ruleta-segment:nth-child(1) { transform: rotate(0deg);   background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
                    #juego-8-ruleta .ruleta-segment:nth-child(2) { transform: rotate(45deg);  background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); }
                    #juego-8-ruleta .ruleta-segment:nth-child(3) { transform: rotate(90deg);  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); }
                    #juego-8-ruleta .ruleta-segment:nth-child(4) { transform: rotate(135deg); background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); }
                    #juego-8-ruleta .ruleta-segment:nth-child(5) { transform: rotate(180deg); background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
                    #juego-8-ruleta .ruleta-segment:nth-child(6) { transform: rotate(225deg); background: linear-gradient(135deg, #ca8a04 0%, #a16207 100%); }
                    #juego-8-ruleta .ruleta-segment:nth-child(7) { transform: rotate(270deg); background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); }
                    #juego-8-ruleta .ruleta-segment:nth-child(8) { transform: rotate(315deg); background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
                    #juego-8-ruleta .ruleta-center { position: absolute; inset: 50%; transform: translate(-50%, -50%); width: 90px; height: 90px; border-radius: 50%; background: linear-gradient(145deg, #1e293b, #0f172a); border: 4px solid #f59e0b; box-shadow: 0 0 20px rgba(245,158,11,0.5), inset 0 0 15px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; font-weight: 900; color: #fbbf24; font-size: 0.85rem; text-align: center; z-index: 2; }
                    #juego-8-ruleta .ruleta-question-card { min-height: 120px; display: flex; align-items: center; justify-content: center; padding: 1.5rem 2rem; border-radius: 1.5rem; background: linear-gradient(145deg, #ffffff, #f8fafc); border: 3px solid #f59e0b; box-shadow: 0 20px 50px rgba(0,0,0,0.4), 0 0 30px rgba(245,158,11,0.2); }
                    #juego-8-ruleta .ruleta-question-card .question-text { font-size: 1.35rem; font-weight: 800; color: #1e293b; text-align: center; margin: 0; line-height: 1.3; }
                    #juego-8-ruleta .btn-girar { background: linear-gradient(145deg, #f59e0b, #d97706); color: #1e293b; font-weight: 900; padding: 0.75rem 1.75rem; border-radius: 2rem; border: none; box-shadow: 0 8px 25px rgba(245,158,11,0.4); transition: transform 0.2s, box-shadow 0.2s; }
                    #juego-8-ruleta .btn-girar:hover { transform: scale(1.05); box-shadow: 0 12px 35px rgba(245,158,11,0.5); }
                </style>
                <div class="slide-container h-full flex flex-col justify-center ruleta-bg">
                    <div class="flex flex-wrap items-center justify-center gap-3 mb-4">
                        <span class="bg-amber-500 text-slate-900 text-xs font-bold px-3 py-1.5 rounded-full uppercase tracking-wider">Juego 8</span>
                        <span class="inline-flex items-center gap-2 bg-amber-400/90 text-slate-900 px-4 py-2 rounded-full font-bold text-sm shadow-lg">
                            <i class="fas fa-bolt text-amber-600"></i> 5 seg por pregunta
                        </span>
                    </div>
                    <h2 class="text-2xl md:text-3xl font-black text-white m-0 text-center mb-1 drop-shadow-md">Rapid Fire</h2>
                    <p class="text-amber-200/90 text-sm font-semibold text-center mb-5">Responde lo más rápido que puedas</p>

                    <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-10">
                        <!-- Ruleta visual -->
                        <div class="relative flex-shrink-0" style="width: 280px; height: 280px;">
                            <div id="ruleta-wheel" class="ruleta-wheel">
                                <div class="ruleta-segment">1</div>
                                <div class="ruleta-segment">2</div>
                                <div class="ruleta-segment">3</div>
                                <div class="ruleta-segment">4</div>
                                <div class="ruleta-segment">5</div>
                                <div class="ruleta-segment">6</div>
                                <div class="ruleta-segment">7</div>
                                <div class="ruleta-segment">8</div>
                                <div class="ruleta-center"><i class="fas fa-question"></i></div>
                            </div>
                            <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-t-[18px] border-t-amber-400 drop-shadow-lg" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));"></div>
                        </div>

                        <!-- Pregunta central + botón -->
                        <div class="flex flex-col items-center gap-4 flex-1 max-w-lg w-full">
                            <div id="ruleta-question-box" class="ruleta-question-card w-full">
                                <p id="ruleta-question-text" class="question-text">Pulsa <strong>Girar la ruleta</strong> para sacar una pregunta al azar.</p>
                            </div>
                            <button type="button" id="btn-girar-ruleta" class="btn-girar flex items-center gap-2">
                                <i class="fas fa-sync-alt"></i> Girar la ruleta
                            </button>
                        </div>
                    </div>
                </div>
                <script>
                (function() {
                    var questions = [
                        '¿Qué cenaste ayer?',
                        '¿A qué hora desayunaste hoy?',
                        '¿Qué compraste la semana pasada?',
                        '¿Cuándo limpiaste tu cuarto?',
                        '¿Qué serie miraste el mes pasado?',
                        '¿Dónde viviste hace 5 años?',
                        '¿A quién llamaste ayer?',
                        '¿Qué idioma estudiaste en el colegio?',
                        '¿Qué regalo recibiste en tu último cumpleaños?',
                        '¿Cuánto tiempo estudiaste anoche?',
                        '¿Qué película viste el fin de semana?',
                        '¿Dónde comiste el domingo?',
                        '¿Quién te ayudó con los deberes?',
                        '¿Cómo llegaste a clase hoy?',
                        '¿Qué libro leíste el mes pasado?',
                        '¿Cuándo viajaste por última vez?',
                        '¿Qué deporte practicaste de pequeño?',
                        '¿Dónde trabajaste el verano pasado?',
                        '¿A qué hora te acostaste ayer?',
                        '¿Qué música escuchaste en el coche?',
                        '¿Con quién hablaste por teléfono ayer?',
                        '¿Qué postre pediste en el restaurante?',
                        '¿Cuánto pagaste por la entrada?'
                    ];
                    var wheel = document.getElementById('ruleta-wheel');
                    var questionEl = document.getElementById('ruleta-question-text');
                    var btn = document.getElementById('btn-girar-ruleta');
                    if (!btn || !questionEl) return;
                    var currentRotation = 0;
                    btn.addEventListener('click', function() {
                        if (typeof playSound === 'function') { try { playSound('spin'); } catch (e) {} }
                        var idx = Math.floor(Math.random() * questions.length);
                        questionEl.textContent = questions[idx];
                        currentRotation += 360 * 3 + idx * 45;
                        if (wheel) wheel.style.transform = 'rotate(' + currentRotation + 'deg)';
                        btn.disabled = true;
                        setTimeout(function() { btn.disabled = false; }, 1200);
                    });
                })();
                </script>
            </section>

            <!-- ========== SLIDE 10: Tarea en casa + Logo Tucaneo ========== -->
            <section>
                <div class="slide-container h-full flex flex-col justify-center items-center">
                    <img src="https://tucaneo.com/wp-content/uploads/2025/11/Plantilla-2-e1764351536337.png"
                         alt="Tucaneo Academy"
                         class="w-32 md:w-40 mb-4 hover:rotate-3 transition-transform duration-500">
                    <h2 class="text-4xl md:text-5xl font-black text-[#004d40] m-0 font-playfair">
                        ¡Misión completada!
                    </h2>
                    <p class="text-slate-500 text-sm font-semibold mt-2 mb-6">Ahora practica en casa con la tarea.</p>
                    <div class="bg-white rounded-2xl shadow-2xl border-t-8 border-[#ff6f00] max-w-2xl w-full text-left overflow-hidden animate-fade-in-up">
                        <div class="flex items-center justify-between px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                            <h3 class="text-xl font-bold text-[#ff6f00] flex items-center gap-2 m-0">
                                <i class="fas fa-home"></i> The Home Country Challenge
                            </h3>
                            <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-3 py-1 rounded-full">Tarea</span>
                        </div>
                        <div class="p-6">
                            <p class="text-slate-600 text-sm mb-4">Elige una opción y practica verbos regulares en <strong>Pretérito Indefinido</strong>.</p>
                            <h4 class="text-emerald-800 font-bold text-lg mb-2 flex items-center gap-2"><i class="fas fa-map-marked-alt text-emerald-500"></i> Opción A: Un viaje por mi país</h4>
                            <p class="text-slate-700 text-sm mb-3">Escribe 8 oraciones sobre un viaje que hiciste en tu país. Responde:</p>
                            <ul class="space-y-1.5 text-slate-700 text-sm font-semibold">
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-emerald-500 text-xs"></i> ¿Qué ciudades visitaste?</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-emerald-500 text-xs"></i> ¿Qué comiste?</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-emerald-500 text-xs"></i> ¿Qué compraste?</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-emerald-500 text-xs"></i> ¿Con quién hablaste?</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <script type="text/babel">
        // --- REACT COMPONENTS (Lógica Corregida) ---
        const { useState, useEffect, useRef, useLayoutEffect } = React;

        // Iconos
        const Icon = ({ p }) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{p}</svg>;
        const I = {
            Pencil: <Icon p={<><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /><path d="m15 5 4 4" /></>} />,
            Eraser: <Icon p={<><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21" /><path d="M22 21H7" /><path d="m5 11 9 9" /></>} />,
            Square: <Icon p={<rect width="18" height="18" x="3" y="3" rx="2" />} />,
            Circle: <Icon p={<circle cx="12" cy="12" r="10" />} />,
            Type: <Icon p={<><polyline points="4 7 4 4 20 4 20 7" /><line x1="9" x2="15" y1="20" y2="20" /><line x1="12" x2="12" y1="4" y2="20" /></>} />,
            Line: <Icon p={<line x1="5" y1="12" x2="19" y2="12" />} />,
            Undo: <Icon p={<><path d="M3 7v6h6" /><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13" /></>} />,
            Redo: <Icon p={<><path d="M21 7v6h-6" /><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 3.7" /></>} />,
            Trash: <Icon p={<><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>} />,
            Save: <Icon p={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>} />,
            Pointer: <Icon p={<><path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z" /><path d="m13 13 6 6" /></>} />,
            Book: <Icon p={<path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />} />,
            Art: <Icon p={<circle cx="13.5" cy="6.5" r=".5" />} />,
            Copy: <Icon p={<rect width="14" height="14" x="8" y="8" rx="2" />} />
        };

        const getHandles = (el) => { const pad = 0; const x = el.x; const y = el.y; const w = el.width; const h = el.height; return { tl: { x: x - pad, y: y - pad, cursor: 'nwse-resize' }, tr: { x: x + w + pad, y: y - pad, cursor: 'nesw-resize' }, bl: { x: x - pad, y: y + h + pad, cursor: 'nesw-resize' }, br: { x: x + w + pad, y: y + h + pad, cursor: 'nwse-resize' } }; };
        const isPointInHandle = (x, y, handle) => { const size = 12; return x >= handle.x - size && x <= handle.x + size && y >= handle.y - size && y <= handle.y + size; };

        // --- GLOSARIO (Sin cambios) ---
        function VocabModule() { const [list, setList] = useState(() => { try { return JSON.parse(localStorage.getItem('tucaneo_vocab') || '[]'); } catch { return []; } }); const [w, setW] = useState(''); const [d, setD] = useState(''); const [manualCopy, setManualCopy] = useState(null); useEffect(() => { try { localStorage.setItem('tucaneo_vocab', JSON.stringify(list)); } catch { } }, [list]); const add = (e) => { e.preventDefault(); if (!w.trim()) return; setList([...list, { w, d }]); setW(''); setD(''); }; const copy = () => { const text = list.map(i => `${i.w}: ${i.d}`).join('\n'); if (!text) return alert("Lista vacía"); try { navigator.clipboard.writeText(text).then(() => alert("Copiado!"), () => setManualCopy(text)); } catch { setManualCopy(text); } }; return (<div className="flex flex-col h-full bg-slate-50 p-6 pt-8 relative font-sans"> {manualCopy && <div className="absolute inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div className="bg-white p-4 rounded-xl w-full max-w-sm shadow-2xl"><p className="font-bold mb-2 text-emerald-800 font-playfair">Copiar datos:</p><textarea className="w-full h-32 border p-2 rounded-lg" readOnly value={manualCopy} onClick={e => e.target.select()} /><button onClick={() => setManualCopy(null)} className="w-full bg-slate-800 text-white py-2 mt-2 rounded-lg">Cerrar</button></div></div>} <h2 className="text-xl font-bold text-emerald-800 mb-4 flex gap-2 font-playfair">{I.Book} Glosario</h2> <form onSubmit={add} className="bg-white p-4 rounded-xl shadow-sm mb-4 border border-emerald-100"><input value={w} onChange={e => setW(e.target.value)} placeholder="Término" className="w-full border-b p-2 mb-2 outline-none focus:border-orange-500 font-bold text-slate-700" /><input value={d} onChange={e => setD(e.target.value)} placeholder="Definición" className="w-full border-b p-2 outline-none focus:border-orange-500 text-slate-500" /><button type="submit" className="w-full bg-orange-500 text-white py-2 rounded-lg font-bold hover:bg-orange-600 mt-2 shadow-md transition">Añadir</button></form> <div className="flex-1 overflow-y-auto bg-white rounded-xl border border-slate-200 p-4 shadow-inner mb-4"><ul className="space-y-3">{list.map((i, k) => (<li key={k} className="flex justify-between border-b border-slate-50 pb-2"><div><span className="block font-bold text-slate-700">{i.w}</span><span className="text-sm text-slate-400 italic">{i.d}</span></div><button onClick={() => setList(list.filter((_, x) => x !== k))} className="text-red-300 hover:text-red-500 bg-red-50 w-6 h-6 rounded-full flex items-center justify-center">×</button></li>))}</ul></div> <button onClick={copy} className="bg-emerald-600 text-white py-2 rounded-lg font-bold flex justify-center gap-2 hover:bg-emerald-700 shadow-lg">{I.Copy} Copiar Lista</button> </div>); }

        // --- PIZARRA (Corregida) ---
        function WhiteboardModule() {
            const [elements, setElements] = useState([]);
            const [history, setHistory] = useState([]);
            const [historyStep, setHistoryStep] = useState(0);
            const [tool, setTool] = useState('pencil');
            const [action, setAction] = useState('none');
            const [panOffset, setPanOffset] = useState({ x: 0, y: 0 });
            const [writingPos, setWritingPos] = useState(null);
            const [defaultText, setDefaultText] = useState(''); // Estado para edición
            const [selectedId, setSelectedId] = useState(null);
            const [confirmClear, setConfirmClear] = useState(false);
            const [resizeHandle, setResizeHandle] = useState(null);
            const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
            const [color, setColor] = useState('#004d40');
            const [strokeWidth, setStrokeWidth] = useState(3);
            const [size, setSize] = useState({ w: 0, h: 0 });
            const [hoverCursor, setHoverCursor] = useState(null);
            const containerRef = useRef(null);
            const canvasRef = useRef(null);
            const textAreaRef = useRef(null);
            const generateId = () => Math.random().toString(36).substr(2, 9);

            useEffect(() => {
                if (!containerRef.current) return;
                const obs = new ResizeObserver(() => setSize({ w: containerRef.current.offsetWidth, h: containerRef.current.offsetHeight }));
                obs.observe(containerRef.current);
                return () => obs.disconnect();
            }, []);

            useEffect(() => {
                if (tool !== 'selection') { setSelectedId(null); setResizeHandle(null); }
                if (confirmClear) setConfirmClear(false);
                // Si cambiamos de herramienta escribiendo, guardamos
                if (action === 'writing' && tool !== 'text') finishWriting();
            }, [tool]);

            // Enfocar textarea al escribir
            useEffect(() => {
                if (action === 'writing' && textAreaRef.current) {
                    textAreaRef.current.value = defaultText; // Poner texto existente si es edición
                    setTimeout(() => {
                        textAreaRef.current?.focus();
                        textAreaRef.current.scrollTop = textAreaRef.current.scrollHeight;
                    }, 10);
                }
            }, [action, writingPos]);

            // Actualizar propiedades al seleccionar
            useEffect(() => {
                if (selectedId && !resizeHandle && action !== 'moving') {
                    const index = elements.findIndex(el => el.id === selectedId);
                    if (index !== -1) {
                        const el = elements[index];
                        if (el.color !== color || el.strokeWidth !== strokeWidth) {
                            const newEls = [...elements];
                            // Recalcular tamaño si es texto
                            let newW = el.width;
                            let newH = el.height;
                            if (el.type === 'text') {
                                const fontSize = Math.max(12, strokeWidth * 4);
                                const lines = el.text.split('\n');
                                newH = lines.length * fontSize * 1.2;
                                const maxLineLen = Math.max(...lines.map(l => l.length));
                                newW = maxLineLen * fontSize * 0.6;
                            }
                            newEls[index] = { ...el, color, strokeWidth, width: newW, height: newH };
                            setElements(newEls);
                        }
                    }
                }
            }, [color, strokeWidth]);

            useEffect(() => {
                if (selectedId) {
                    const el = elements.find(e => e.id === selectedId);
                    if (el) { setColor(el.color); setStrokeWidth(el.strokeWidth); }
                }
            }, [selectedId]);

            // RENDERIZADO (Con soporte multilínea)
            useLayoutEffect(() => {
                const ctx = canvasRef.current?.getContext('2d');
                if (!ctx || size.w === 0) return;
                canvasRef.current.width = size.w;
                canvasRef.current.height = size.h;
                ctx.clearRect(0, 0, size.w, size.h);

                // Grid
                ctx.save();
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, size.w, size.h);
                ctx.strokeStyle = '#f1f5f9';
                ctx.lineWidth = 1;
                ctx.beginPath();
                const gridSize = 40;
                const offsetX = panOffset.x % gridSize;
                const offsetY = panOffset.y % gridSize;
                for (let x = offsetX; x < size.w; x += gridSize) { ctx.moveTo(x, 0); ctx.lineTo(x, size.h); }
                for (let y = offsetY; y < size.h; y += gridSize) { ctx.moveTo(0, y); ctx.lineTo(size.w, y); }
                ctx.stroke();
                ctx.restore();

                ctx.save();
                ctx.translate(panOffset.x, panOffset.y);

                elements.forEach(el => {
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    if (el.type === 'eraser') { ctx.strokeStyle = '#ffffff'; ctx.lineWidth = el.strokeWidth * 4; }
                    else { ctx.strokeStyle = el.color; ctx.lineWidth = el.strokeWidth; ctx.fillStyle = el.color; }

                    if ((el.type === 'pencil' || el.type === 'eraser') && el.points.length > 0) {
                        ctx.beginPath();
                        ctx.moveTo(el.points[0].x, el.points[0].y);
                        for (let i = 1; i < el.points.length; i++) ctx.lineTo(el.points[i].x, el.points[i].y);
                        ctx.stroke();
                    } else if (el.type === 'rectangle') {
                        ctx.strokeRect(el.x, el.y, el.width, el.height);
                    } else if (el.type === 'circle') {
                        ctx.beginPath();
                        const r = Math.sqrt(Math.pow(el.width, 2) + Math.pow(el.height, 2)) / 2;
                        ctx.arc(el.x + el.width / 2, el.y + el.height / 2, Math.abs(r), 0, 2 * Math.PI);
                        ctx.stroke();
                    } else if (el.type === 'line') {
                        ctx.beginPath();
                        ctx.moveTo(el.x, el.y);
                        ctx.lineTo(el.x + el.width, el.y + el.height);
                        ctx.stroke();
                    } else if (el.type === 'text' && el.text) {
                        const fontSize = Math.max(12, el.strokeWidth * 4);
                        ctx.font = `${fontSize}px 'Lato', sans-serif`;
                        ctx.textBaseline = 'top';

                        // LÓGICA DE MULTILÍNEA
                        const lines = el.text.split('\n');
                        let maxWidth = 0;
                        lines.forEach((line, index) => {
                            ctx.fillText(line, el.x, el.y + (index * fontSize * 1.2));
                            const m = ctx.measureText(line);
                            if (m.width > maxWidth) maxWidth = m.width;
                        });

                        el.width = maxWidth;
                        el.height = lines.length * fontSize * 1.2;
                    }
                });

                if (selectedId) {
                    const el = elements.find(e => e.id === selectedId);
                    if (el) {
                        const isPencil = el.type === 'pencil' || el.type === 'eraser';
                        ctx.strokeStyle = '#ff6f00';
                        ctx.lineWidth = 1;
                        ctx.setLineDash([5, 5]);
                        let bx = el.x, by = el.y, bw = el.width, bh = el.height;
                        if (isPencil) {
                            const xs = el.points.map(p => p.x); const ys = el.points.map(p => p.y);
                            bx = Math.min(...xs); by = Math.min(...ys); bw = Math.max(...xs) - bx; bh = Math.max(...ys) - by;
                        } else {
                            if (bw < 0) { bx += bw; bw = Math.abs(bw); }
                            if (bh < 0) { by += bh; bh = Math.abs(bh); }
                        }
                        ctx.strokeRect(bx - 5, by - 5, bw + 10, bh + 10);
                        ctx.setLineDash([]);
                        if (!isPencil) {
                            const handles = getHandles({ x: bx, y: by, width: bw, height: bh });
                            ctx.fillStyle = '#ffffff'; ctx.strokeStyle = '#ff6f00'; ctx.lineWidth = 2;
                            Object.values(handles).forEach(h => { ctx.beginPath(); ctx.rect(h.x - 4, h.y - 4, 8, 8); ctx.fill(); ctx.stroke(); });
                        }
                    }
                }
                ctx.restore();
            }, [elements, size, panOffset, selectedId]);

            const updateHistory = (newEls) => {
                const newHist = history.slice(0, historyStep + 1);
                newHist.push(newEls);
                setHistory(newHist);
                setHistoryStep(newHist.length - 1);
            };
            const undo = () => { if (historyStep > 0) { setHistoryStep(s => s - 1); setElements(history[historyStep - 1]); setSelectedId(null); } else { setHistoryStep(-1); setElements([]); setSelectedId(null); } };
            const redo = () => { if (historyStep < history.length - 1) { setHistoryStep(s => s + 1); setElements(history[historyStep + 1]); setSelectedId(null); } };
            const getPos = (e) => {
                const rect = canvasRef.current.getBoundingClientRect();
                const cx = e.touches ? e.touches[0].clientX : e.clientX;
                const cy = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: cx - rect.left - panOffset.x, y: cy - rect.top - panOffset.y };
            };

            const isPointInElement = (x, y, el) => {
                const padding = 10;
                let bx = el.x, by = el.y, bw = el.width, bh = el.height;
                if (el.type === 'pencil' || el.type === 'eraser') {
                    const xs = el.points.map(p => p.x); const ys = el.points.map(p => p.y);
                    bx = Math.min(...xs); by = Math.min(...ys); bw = Math.max(...xs) - bx; bh = Math.max(...ys) - by;
                } else {
                    if (bw < 0) { bx += bw; bw = Math.abs(bw); }
                    if (bh < 0) { by += bh; bh = Math.abs(bh); }
                }
                return x >= bx - padding && x <= bx + bw + padding && y >= by - padding && y <= by + bh + padding;
            };

            // MANEJO DE DOBLE CLIC (EDITAR)
            const handleDoubleClick = (e) => {
                const { x, y } = getPos(e);
                for (let i = elements.length - 1; i >= 0; i--) {
                    const el = elements[i];
                    if (el.type === 'text' && isPointInElement(x, y, el)) {
                        setDefaultText(el.text);
                        setWritingPos({ x: el.x, y: el.y });
                        setTool('text');
                        setAction('writing');
                        setColor(el.color);
                        setStrokeWidth(el.strokeWidth);
                        const newEls = elements.filter(item => item.id !== el.id);
                        setElements(newEls);
                        return;
                    }
                }
            };

            const handleDown = (e) => {
                if (['BUTTON', 'INPUT', 'TEXTAREA', 'LABEL', 'SELECT'].includes(e.target.tagName)) return;
                e.preventDefault();

                const { x, y } = getPos(e);

                if (tool === 'selection') {
                    if (selectedId) {
                        const el = elements.find(e => e.id === selectedId);
                        if (el && (el.type !== 'pencil' && el.type !== 'eraser')) {
                            let bx = el.x, by = el.y, bw = el.width, bh = el.height;
                            if (bw < 0) { bx += bw; bw = Math.abs(bw); }
                            if (bh < 0) { by += bh; bh = Math.abs(bh); }
                            const handles = getHandles({ x: bx, y: by, width: bw, height: bh });
                            for (const key in handles) {
                                if (isPointInHandle(x, y, handles[key])) { setResizeHandle(key); setAction('resizing'); return; }
                            }
                        }
                    }
                    let foundId = null;
                    if (selectedId) {
                        const el = elements.find(e => e.id === selectedId);
                        if (el && isPointInElement(x, y, el)) foundId = selectedId;
                    }
                    if (!foundId) {
                        for (let i = elements.length - 1; i >= 0; i--) {
                            if (isPointInElement(x, y, elements[i])) { foundId = elements[i].id; break; }
                        }
                    }
                    setSelectedId(foundId);
                    if (foundId) {
                        setAction('moving');
                        const el = elements.find(e => e.id === foundId);
                        setDragOffset({ x: x - el.x, y: y - el.y });
                    } else {
                        setAction('panning');
                    }
                    return;
                }

                if (tool === 'text') {
                    if (action === 'writing') {
                        finishWriting();
                    } else {
                        setDefaultText('');
                        setAction('writing');
                        setWritingPos({ x, y });
                    }
                    return;
                }

                setAction('drawing');
                const newEl = {
                    id: generateId(),
                    type: tool,
                    x, y,
                    width: 0, height: 0,
                    color, strokeWidth,
                    points: (tool === 'pencil' || tool === 'eraser') ? [{ x, y }] : undefined
                };
                setElements(prev => [...prev, newEl]);
            };

            const handleMove = (e) => {
                const { x, y } = getPos(e);
                if (tool === 'selection' && selectedId && action === 'none') {
                    const el = elements.find(e => e.id === selectedId);
                    if (el) {
                        if (el.type !== 'pencil' && el.type !== 'eraser') {
                            let bx = el.x, by = el.y, bw = el.width, bh = el.height;
                            if (bw < 0) { bx += bw; bw = Math.abs(bw); }
                            if (bh < 0) { by += bh; bh = Math.abs(bh); }
                            const handles = getHandles({ x: bx, y: by, width: bw, height: bh });
                            let cursor = null;
                            for (const key in handles) { if (isPointInHandle(x, y, handles[key])) cursor = handles[key].cursor; }
                            setHoverCursor(cursor);
                        }
                        if (!hoverCursor && isPointInElement(x, y, el)) { setHoverCursor('move'); }
                    } else { setHoverCursor(null); }
                } else if (action === 'none') { setHoverCursor(null); }

                if (action === 'panning') { setPanOffset(p => ({ x: p.x + (e.movementX || 0), y: p.y + (e.movementY || 0) })); return; }

                if (action === 'moving' && selectedId) {
                    const els = [...elements];
                    const index = els.findIndex(e => e.id === selectedId);
                    const el = els[index];
                    const newX = x - dragOffset.x;
                    const newY = y - dragOffset.y;
                    if (el.type === 'pencil' || el.type === 'eraser') {
                        const dx = newX - el.x; const dy = newY - el.y;
                        const newPoints = el.points.map(p => ({ x: p.x + dx, y: p.y + dy }));
                        els[index] = { ...el, x: newX, y: newY, points: newPoints };
                    } else {
                        els[index] = { ...el, x: newX, y: newY };
                    }
                    setElements(els);
                    return;
                }

                if (action === 'resizing' && selectedId && resizeHandle) {
                    const els = [...elements];
                    const index = els.findIndex(e => e.id === selectedId);
                    const el = els[index];
                    if (el.type === 'text') {
                        let newHeight = el.height;
                        if (resizeHandle.includes('b')) newHeight = y - el.y;
                        if (resizeHandle.includes('t')) newHeight = el.y + el.height - y;
                        if (newHeight < 10) newHeight = 10;
                        const newStrokeWidth = newHeight / 4;
                        const lines = el.text.split('\n');
                        const maxLen = Math.max(...lines.map(l => l.length));
                        els[index] = {
                            ...el,
                            strokeWidth: newStrokeWidth,
                            height: lines.length * newHeight * 1.2,
                            width: maxLen * newHeight * 0.6
                        };
                    } else {
                        let newX = el.x, newY = el.y, newW = el.width, newH = el.height;
                        if (resizeHandle === 'br') { newW = x - newX; newH = y - newY; }
                        else if (resizeHandle === 'bl') { newW = (newX + newW) - x; newX = x; newH = y - newY; }
                        else if (resizeHandle === 'tr') { newW = x - newX; newH = (newY + newH) - y; newY = y; }
                        else if (resizeHandle === 'tl') { newW = (newX + newW) - x; newX = x; newH = (newY + newH) - y; newY = y; }
                        els[index] = { ...el, x: newX, y: newY, width: newW, height: newH };
                    }
                    setElements(els);
                    return;
                }

                if (action === 'drawing') {
                    const els = [...elements];
                    const curr = els[els.length - 1];
                    if (tool === 'pencil' || tool === 'eraser') curr.points.push({ x, y });
                    else { curr.width = x - curr.x; curr.height = y - curr.y; }
                    setElements(els);
                }
            };

            const handleUp = () => {
                if (action === 'drawing' || action === 'resizing' || action === 'moving') updateHistory(elements);
                if (action !== 'writing') { setAction('none'); setResizeHandle(null); }
            };

            const finishWriting = () => {
                if (!textAreaRef.current || !writingPos) {
                    setAction('none'); setWritingPos(null); return;
                }
                const text = textAreaRef.current.value.trim();
                if (text) {
                    const fontSize = Math.max(12, strokeWidth * 4);
                    const lines = text.split('\n');
                    const totalHeight = lines.length * fontSize * 1.2;
                    const maxLineLen = Math.max(...lines.map(l => l.length));
                    const approxWidth = maxLineLen * fontSize * 0.6;

                    const newEls = [...elements, {
                        id: generateId(),
                        type: 'text',
                        x: writingPos.x,
                        y: writingPos.y,
                        text, color, strokeWidth,
                        width: approxWidth,
                        height: totalHeight
                    }];
                    setElements(newEls);
                    updateHistory(newEls);
                }
                setAction('none');
                setWritingPos(null);
                setDefaultText('');
            };

            const save = () => {
                const a = document.createElement('a'); a.download = 'pizarra-tucaneo.png'; a.href = canvasRef.current.toDataURL(); a.click();
            };

            let cursorClass = 'cursor-crosshair';
            if (hoverCursor) cursorClass = `cursor-${hoverCursor}`;
            else if (tool === 'selection') cursorClass = action === 'panning' ? 'cursor-grabbing' : 'cursor-default';
            else if (tool === 'text') cursorClass = 'cursor-text';
            else if (tool === 'eraser') cursorClass = 'cursor-eraser';

            return (
                <div ref={containerRef}
                    onDoubleClick={handleDoubleClick}
                    className={`absolute inset-0 bg-white select-none touch-none overflow-hidden ${cursorClass}`}>

                    <div className="absolute top-1/2 -translate-y-1/2 left-4 z-50 flex flex-col gap-2 bg-white/95 p-2 rounded-xl shadow-lg border border-slate-200">
                        <button onClick={() => setTool('selection')} title="Seleccionar (Mover y Editar)" className={`p-3 rounded-lg transition-colors ${tool === 'selection' ? 'bg-orange-100 text-orange-600' : 'text-gray-400 hover:bg-gray-100'}`}>{I.Pointer}</button>
                        <div className="w-full h-px bg-gray-200 my-1"></div>
                        <button onClick={() => setTool('eraser')} title="Borrador" className={`p-3 rounded-lg transition-colors ${tool === 'eraser' ? 'bg-orange-100 text-orange-600' : 'text-gray-400 hover:bg-gray-100'}`}>{I.Eraser}</button>
                        {[{ id: 'pencil', i: I.Pencil, t: 'Lápiz' }, { id: 'rectangle', i: I.Square, t: 'Cuadrado' }, { id: 'circle', i: I.Circle, t: 'Círculo' }, { id: 'line', i: I.Line, t: 'Línea' }, { id: 'text', i: I.Type, t: 'Texto' }].map(t => (
                            <button key={t.id} onClick={() => setTool(t.id)} title={t.t} className={`p-3 rounded-lg transition-colors ${tool === t.id ? 'bg-orange-100 text-orange-600' : 'text-gray-400 hover:bg-gray-100'}`}>{t.i}</button>
                        ))}
                    </div>

                    <div className="absolute bottom-4 left-1/2 -translate-x-1/2 z-50 bg-white/95 px-6 py-3 rounded-full shadow-lg border border-slate-200 flex items-center gap-4 w-max max-w-[90vw] overflow-x-auto">
                        <input type="color" value={color} onChange={e => setColor(e.target.value)} className="w-8 h-8 rounded-full border-none cursor-pointer flex-shrink-0" title="Color" />
                        <div className="flex items-center gap-2 flex-shrink-0">
                            <span className="text-xs font-bold text-gray-400 hidden md:block">GROSOR</span>
                            <input type="range" min="1" max="20" value={strokeWidth} onChange={e => setStrokeWidth(Number(e.target.value))} className="w-24 accent-emerald-500" title="Tamaño" />
                        </div>
                        <div className="w-px h-8 bg-gray-200 mx-1 hidden md:block"></div>
                        <div className="flex gap-1 flex-shrink-0">
                            <button onClick={undo} disabled={historyStep < 0} className="p-2 text-gray-500 hover:bg-gray-100 rounded-full disabled:opacity-30">{I.Undo}</button>
                            <button onClick={redo} disabled={historyStep >= history.length - 1} className="p-2 text-gray-500 hover:bg-gray-100 rounded-full disabled:opacity-30">{I.Redo}</button>
                            <button onClick={() => { if (!confirmClear) { setConfirmClear(true); setTimeout(() => setConfirmClear(false), 3000) } else { setElements([]); setConfirmClear(false); } }} className={`p-2 rounded-full font-bold text-xs transition-colors ${confirmClear ? 'bg-red-500 text-white px-3' : 'text-red-500 hover:bg-red-50'}`}>{confirmClear ? 'CONFIRMAR' : I.Trash}</button>
                        </div>
                        <button onClick={save} className="ml-2 bg-slate-800 text-white px-4 py-2 rounded-full text-sm font-bold flex gap-2 items-center hover:bg-slate-900 transition-colors flex-shrink-0 uppercase tracking-wider">{I.Save} <span className="hidden md:inline">Guardar</span></button>
                    </div>

                    <canvas ref={canvasRef} onMouseDown={handleDown} onMouseMove={handleMove} onMouseUp={handleUp} onMouseLeave={handleUp} onTouchStart={handleDown} onTouchMove={handleMove} onTouchEnd={handleUp} className="absolute inset-0 w-full h-full z-20" />

                    {action === 'writing' && writingPos && (
                        <div className="fixed z-[100] fade-in" style={{ left: writingPos.x + panOffset.x + (containerRef.current?.getBoundingClientRect().left || 0), top: writingPos.y + panOffset.y, }}>
                            <textarea
                                ref={textAreaRef}
                                onKeyDown={(e) => {
                                    // Evitar que el evento suba a Reveal.js
                                    e.stopPropagation();
                                    // Si es ESC, cerramos, pero ENTER ahora funciona normal (salto de línea)
                                    if (e.key === 'Escape') finishWriting();
                                }}
                                onBlur={finishWriting}
                                className="bg-white border-2 border-emerald-500 rounded-lg p-3 shadow-2xl outline-none text-slate-900 placeholder-slate-400 overflow-hidden resize-both font-sans"
                                style={{ font: `${Math.max(12, strokeWidth * 4)}px 'Lato', sans-serif`, minWidth: '200px', minHeight: '60px' }}
                                placeholder="Escriba aquí..."
                            />
                        </div>
                    )}
                </div>
            );
        }

        // --- APP PRINCIPAL (Contenedor) ---
        function App() {
            const [tab, setTab] = useState('board');
            const close = () => window.toggleDrawer();
            useEffect(() => {
                const handler = (e) => {
                    if (e.key.toLowerCase() === 'h' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) close();
                };
                window.addEventListener('keydown', handler);
                const toolHandler = (e) => {
                    const toolName = e.detail;
                    setTab(toolName);
                    const drawer = document.getElementById('tucaneo-drawer');
                    if (drawer && !drawer.classList.contains('is-open')) {
                        drawer.classList.add('is-open');
                    }
                };
                window.addEventListener('open-tool', toolHandler);
                return () => {
                    window.removeEventListener('keydown', handler);
                    window.removeEventListener('open-tool', toolHandler);
                };
            }, []);
            return (
                <div className="h-full flex flex-col bg-slate-50">
                    <div className="bg-white border-b border-slate-200 h-14 shrink-0 flex items-center px-4 gap-6">
                        <button onClick={() => setTab('board')} className={`h-full flex items-center gap-2 border-b-2 font-bold px-2 transition-colors ${tab === 'board' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-400'}`}>{I.Art} Pizarra</button>
                        <button onClick={() => setTab('vocab')} className={`h-full flex items-center gap-2 border-b-2 font-bold px-2 transition-colors ${tab === 'vocab' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-400'}`}>{I.Book} Glosario</button>
                        <div className="flex-1"></div>
                    </div>
                    <div className="flex-1 relative overflow-hidden">
                        <div className={`absolute inset-0 ${tab === 'board' ? 'z-10' : '-z-10 opacity-0 pointer-events-none'}`}><WhiteboardModule /></div>
                        <div className={`absolute inset-0 ${tab === 'vocab' ? 'z-10' : '-z-10 opacity-0 pointer-events-none'}`}><VocabModule /></div>
                    </div>
                </div>
            );
        }

        // RENDERIZADO FINAL
        const root = ReactDOM.createRoot(document.getElementById('tools-root'));
        root.render(<App />);
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.js"></script>

    <script>
        // Lógica Principal
        const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        const isSmallScreen = window.innerWidth < 1024;
        const isMobile = isTouch || isSmallScreen;

        if (isMobile) {
            console.log("Modo Móvil: Desactivando lógica de presentación.");
            document.body.classList.add('is-mobile');

            // NO INICIAMOS REVEAL.JS EN MÓVIL
            // Dejamos que el CSS haga todo el trabajo de scroll vertical.

            // Barra de progreso manual
            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                const progressBar = document.getElementById('scroll-progress');
                if (progressBar) progressBar.style.width = scrolled + '%';

                const btn = document.getElementById('back-to-top');
                if (btn) (winScroll > 300) ? btn.classList.add('visible') : btn.classList.remove('visible');
            });
        } else {
            // PC: Iniciamos Reveal (Solo aquí)
            Reveal.initialize({
                // ... tu configuración de PC ...
                width: "100%", height: "100%", margin: 0, minScale: 1, maxScale: 1,
                transition: 'slide', backgroundTransition: 'fade', background: '#fefce8'
            });
        }

        function toggleDrawer() { document.getElementById('tucaneo-drawer').classList.toggle('is-open'); }
        function openTool(toolName) { window.dispatchEvent(new CustomEvent('open-tool', { detail: toolName })); }

        // --- CONTROL INTELIGENTE DE TECLAS (VERSIÓN FINAL) ---
        function handleZoomNavigation(e) {
            // 1. Ignorar si el usuario escribe en un input
            if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;

            // 2. Guardamos la posición EXACTA (diapositiva H y V) antes de movernos
            const indicesBefore = Reveal.getIndices();
            let actionTriggered = false;

            // 3. Ejecutamos la acción de Reveal
            if (e.key === 'ArrowLeft') {
                Reveal.prev();
                actionTriggered = true;
            } else if (e.key === 'ArrowRight' || e.code === 'Space') {
                Reveal.next();
                actionTriggered = true;
            }

            // 4. Decidimos si hacer scroll arriba o no
            if (actionTriggered) {
                const indicesAfter = Reveal.getIndices();

                // LÓGICA: Si la diapositiva Horizontal (h) o Vertical (v) cambió, es una diapositiva nueva -> SCROLL TOP
                // Si h y v son iguales, significa que solo cambió el fragmento (f) -> NO SCROLL
                if (indicesBefore.h !== indicesAfter.h || indicesBefore.v !== indicesAfter.v) {
                    window.scrollTo(0, 0);
                }
                // Si no, nos quedamos quietos para ver la respuesta que acabamos de revelar.
            }
        }

        function forceZoom() {
            if (isMobile) return;

            const container = document.querySelector('.reveal');
            const btn = document.getElementById('btn-zoom');
            const html = document.documentElement;
            const body = document.body;

            const isActive = container.classList.contains('is-zoomed');

            if (!isActive) {
                // --- ACTIVAR ZOOM ---
                html.classList.add('is-scrollable');
                body.classList.add('is-scrollable');
                container.classList.add('is-zoomed');

                // Apagamos teclado nativo de Reveal y encendemos el nuestro
                Reveal.configure({ keyboard: false });
                document.addEventListener('keydown', handleZoomNavigation);

                btn.classList.add('active');

            } else {
                // --- DESACTIVAR ZOOM ---
                window.scrollTo(0, 0);
                html.classList.remove('is-scrollable');
                body.classList.remove('is-scrollable');
                container.classList.remove('is-zoomed');

                // Restauramos todo
                Reveal.configure({ keyboard: true });
                document.removeEventListener('keydown', handleZoomNavigation);
                Reveal.layout();

                btn.classList.remove('active');
            }
        }

        const sounds = {
            confetti: new Audio('https://www.myinstants.com/media/sounds/success-sound-effect.mp3'),
            applause: new Audio('https://www.myinstants.com/media/sounds/kids-cheering.mp3'),
            error: new Audio('https://www.myinstants.com/media/sounds/error-sound.mp3'),
            spin: new Audio('https://assets.mixkit.co/active_storage/sfx/2570-wheel-spin-996.mp3')
        };

        function playSound(name) {
            console.log("Playing sound:", name);
            if (sounds[name]) {
                sounds[name].currentTime = 0;
                sounds[name].volume = 0.5;
                sounds[name].play().then(() => {
                    console.log("Sound played successfully");
                }).catch(e => {
                    console.warn("Audio play failed:", e);
                });
            }
        }

        function react(type) {
            playSound(type);
            switch (type) {
                case 'confetti':
                    var duration = 2000; var end = Date.now() + duration;
                    (function frame() {
                        confetti({ particleCount: 4, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#004d40', '#ff6f00'], zIndex: 8000 });
                        confetti({ particleCount: 4, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#004d40', '#ff6f00'], zIndex: 8000 });
                        if (Date.now() < end) requestAnimationFrame(frame);
                    }());
                    break;
                case 'applause':
                    confetti({ shapes: ['emoji'], emoji: ['👏', '🦜', '☀️'], scalar: 3, spread: 100, particleCount: 30, origin: { y: 1 }, zIndex: 8000, startVelocity: 45 });
                    break;
                case 'error':
                    break;
            }
        }

        // Mental Agility Check Function
        function checkMentalAgility() {
            const inputs = document.querySelectorAll('#mental-agility-exercises input[data-correct]');
            let correctCount = 0;
            let totalCount = inputs.length;

            inputs.forEach((input, index) => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = input.getAttribute('data-correct').toLowerCase();
                const resultIcon = input.parentElement.querySelector('.result-icon');
                const exerciseDiv = input.parentElement;

                // Normalize answers (remove accents for comparison)
                const normalizeText = (text) => {
                    return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                };

                const isCorrect = normalizeText(userAnswer) === normalizeText(correctAnswer) || userAnswer === correctAnswer;

                if (isCorrect) {
                    correctCount++;
                    resultIcon.innerHTML = '<i class="fas fa-check-circle text-emerald-500 text-xl"></i>';
                    exerciseDiv.classList.remove('border-red-300', 'bg-red-50');
                    exerciseDiv.classList.add('border-emerald-300', 'bg-emerald-50');
                    input.classList.add('text-emerald-700', 'font-bold');
                } else {
                    resultIcon.innerHTML = '<i class="fas fa-times-circle text-red-500 text-xl"></i>';
                    exerciseDiv.classList.remove('border-emerald-300', 'bg-emerald-50');
                    exerciseDiv.classList.add('border-red-300', 'bg-red-50');
                    input.classList.add('text-red-600');

                    // Show correct answer
                    if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('correct-answer')) {
                        const correctSpan = document.createElement('span');
                        correctSpan.className = 'correct-answer text-emerald-600 font-bold text-sm ml-2';
                        correctSpan.textContent = `✓ ${correctAnswer}`;
                        resultIcon.after(correctSpan);
                    }
                }
            });

            // Display results
            const resultDiv = document.getElementById('mental-agility-result');
            const percentage = Math.round((correctCount / totalCount) * 100);

            if (correctCount === totalCount) {
                resultDiv.innerHTML = `<span class="text-emerald-600">🎉 Perfect! ${correctCount}/${totalCount} - ¡Perfecto!</span>`;
                react('confetti');
            } else if (percentage >= 70) {
                resultDiv.innerHTML = `<span class="text-orange-600">👍 Good! ${correctCount}/${totalCount} (${percentage}%) - ¡Bien!</span>`;
                playSound('applause');
            } else {
                resultDiv.innerHTML = `<span class="text-slate-600">📝 Keep practicing! ${correctCount}/${totalCount} (${percentage}%) - ¡Sigue practicando!</span>`;
            }
        }

        // Translation Challenge Check Function
        function checkTranslation() {
            const inputs = document.querySelectorAll('#translation-exercises input[data-correct]');
            let correctCount = 0;
            let totalCount = inputs.length;

            inputs.forEach((input, index) => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = input.getAttribute('data-correct').toLowerCase();
                const feedbackDiv = input.parentElement.querySelector('.result-feedback');
                const exerciseDiv = input.parentElement;

                // Normalize answers (remove accents and punctuation for comparison)
                const normalizeText = (text) => {
                    return text
                        .normalize("NFD")
                        .replace(/[\u0300-\u036f]/g, "")
                        .replace(/[¿?¡!.,;:]/g, "")
                        .trim();
                };

                const isCorrect = normalizeText(userAnswer) === normalizeText(correctAnswer) || userAnswer === correctAnswer;

                if (isCorrect) {
                    correctCount++;
                    feedbackDiv.innerHTML = '<div class="flex items-center gap-2"><i class="fas fa-check-circle text-emerald-500 text-lg"></i><span class="text-emerald-600 font-bold text-sm">¡Correcto! / Correct!</span></div>';
                    exerciseDiv.classList.remove('border-red-300', 'bg-red-50');
                    exerciseDiv.classList.add('border-emerald-300', 'bg-emerald-50');
                    input.classList.add('text-emerald-700', 'font-bold');
                    input.classList.remove('text-red-600');
                } else {
                    feedbackDiv.innerHTML = `<div class="flex flex-col gap-1"><div class="flex items-center gap-2"><i class="fas fa-times-circle text-red-500 text-lg"></i><span class="text-red-600 font-bold text-sm">Incorrecto / Incorrect</span></div><div class="text-emerald-600 font-bold text-sm">✓ ${correctAnswer}</div></div>`;
                    exerciseDiv.classList.remove('border-emerald-300', 'bg-emerald-50');
                    exerciseDiv.classList.add('border-red-300', 'bg-red-50');
                    input.classList.add('text-red-600');
                    input.classList.remove('text-emerald-700', 'font-bold');
                }
            });

            // Display results
            const resultDiv = document.getElementById('translation-result');
            const percentage = Math.round((correctCount / totalCount) * 100);

            if (correctCount === totalCount) {
                resultDiv.innerHTML = `<span class="text-emerald-600">🎉 Perfect! ${correctCount}/${totalCount} - ¡Perfecto!</span>`;
                react('confetti');
            } else if (percentage >= 70) {
                resultDiv.innerHTML = `<span class="text-orange-600">👍 Good! ${correctCount}/${totalCount} (${percentage}%) - ¡Bien!</span>`;
                playSound('applause');
            } else {
                resultDiv.innerHTML = `<span class="text-slate-600">📝 Keep practicing! ${correctCount}/${totalCount} (${percentage}%) - ¡Sigue practicando!</span>`;
            }
        }

        // Check Colombia Text Exercise
        function checkColombiaText() {
            const inputs = document.querySelectorAll('#colombia-text-exercise .text-input-inline');
            let correctCount = 0;
            const totalCount = inputs.length;

            inputs.forEach(input => {
                const userAnswer = input.value.trim();
                const correctAnswer = input.getAttribute('data-correct');

                // Normalize text for comparison (case-insensitive)
                const normalizeText = (text) => {
                    return text
                        .toLowerCase()
                        .normalize("NFD")
                        .replace(/[\u0300-\u036f]/g, "")
                        .trim();
                };

                const isCorrect = normalizeText(userAnswer) === normalizeText(correctAnswer);

                // Remove previous classes
                input.classList.remove('correct', 'incorrect');

                if (isCorrect) {
                    correctCount++;
                    input.classList.add('correct');
                } else {
                    input.classList.add('incorrect');
                }
            });

            // Display results
            const resultDiv2 = document.getElementById('colombia-result');
            const percentage2 = Math.round((correctCount / totalCount) * 100);

            if (correctCount === totalCount) {
                resultDiv2.innerHTML = `<span class="text-emerald-600">🎉 ¡Perfecto! ${correctCount}/${totalCount} - Perfect!</span>`;
                if (typeof confetti !== 'undefined') {
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
            } else if (percentage2 >= 70) {
                resultDiv2.innerHTML = `<span class="text-orange-600">👍 ¡Bien! ${correctCount}/${totalCount} (${percentage2}%) - Good!</span>`;
            } else {
                resultDiv2.innerHTML = `<span class="text-slate-600">📝 Sigue practicando - ${correctCount}/${totalCount} (${percentage2}%)</span>`;
            }
        }

    </script>
    <style>
        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes spin-reverse {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }

        @keyframes float-up {

            0%,
            100% {
                transform: translateY(0) translateX(-50%);
            }

            50% {
                transform: translateY(-10px) translateX(-50%);
            }
        }

        /* Custom Classes for JS injection */
        .animate-spin-slow {
            animation: spin-slow 10s linear infinite;
        }

        .animate-spin-reverse {
            animation: spin-reverse 8s linear infinite;
        }

        .animate-shake {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }
    </style>

    <script>
        // --- GAME LOGIC: ENERGY CORE ---
        const CoreGame = {
            state: {
                level: 0,
                score: 0,
                maxLevels: 10,
                currentVerb: null,
                isLocked: false
            },
            data: [
                { verb: "HACER", yo: "Hago", distractors: ["Haco", "Haca", "Hacer"] },
                { verb: "PONER", yo: "Pongo", distractors: ["Pono", "Pona", "Poni"] },
                { verb: "SALIR", yo: "Salgo", distractors: ["Salo", "Sali", "Sala"] },
                { verb: "TRAER", yo: "Traigo", distractors: ["Traio", "Trao", "Trae"] },
                { verb: "VER", yo: "Veo", distractors: ["Vo", "Voi", "Vi"] },
                { verb: "SABER", yo: "Sé", distractors: ["Sabo", "Se", "Sabe"] },
                { verb: "DAR", yo: "Doy", distractors: ["Do", "Da", "Dio"] },
                { verb: "IR", yo: "Voy", distractors: ["Iro", "Yo", "Va"] },
                { verb: "ESTAR", yo: "Estoy", distractors: ["Esto", "Estoy", "Esta"] },
                { verb: "CONOCER", yo: "Conozco", distractors: ["Conoco", "Conoce", "Conoca"] }
            ],

            init: function () {
                this.state.level = 0;
                this.state.score = 0;
                this.state.isLocked = false;

                // Shuffle data
                this.data.sort(() => Math.random() - 0.5);

                document.getElementById('game-intro').classList.remove('hidden');
                document.getElementById('game-interface').classList.add('hidden');
                document.getElementById('game-result').classList.add('hidden');

                // Reset HUD
                this.updateHUD();
            },

            start: function () {
                document.getElementById('game-intro').classList.add('hidden');
                document.getElementById('game-interface').classList.remove('hidden');
                this.loadLevel();
            },

            loadLevel: function () {
                if (this.state.level >= this.state.maxLevels) {
                    this.endGame();
                    return;
                }

                this.state.isLocked = false;
                const currentData = this.data[this.state.level];
                this.state.currentVerb = currentData;

                // Update HUD
                this.updateHUD();

                // Set Core Verb
                const coreOrb = document.getElementById('core-orb');
                coreOrb.className = "w-32 h-32 rounded-full bg-gradient-to-br from-purple-500 via-indigo-600 to-purple-800 shadow-[0_0_50px_rgba(124,58,237,0.5)] flex items-center justify-center transform transition-all duration-300 z-10 relative overflow-hidden";
                document.getElementById('target-verb').innerText = currentData.verb;

                // Generate Options
                const options = [currentData.yo, ...currentData.distractors];
                options.sort(() => Math.random() - 0.5);

                const container = document.getElementById('options-container');
                container.innerHTML = '';

                // Positions for 4 satellites (Top, Right, Bottom, Left) - Handling positioning via translate classes to center them relative to container center
                const positions = [
                    "top-4 left-1/2 -translate-x-1/2",           // Top
                    "top-1/2 right-4 translate-x-1/2 -translate-y-1/2", // Right
                    "bottom-4 left-1/2 -translate-x-1/2",        // Bottom
                    "top-1/2 left-4 -translate-x-1/2 -translate-y-1/2"  // Left
                ];

                options.forEach((opt, index) => {
                    const btn = document.createElement('button');
                    // Add some randomness to float animation delay
                    const delay = Math.random() * 2;
                    // We use inline style for delay
                    // Note: 'absolute' positioning with specific coordinate classes
                    btn.className = `absolute ${positions[index]} pointer-events-auto bg-white hover:bg-purple-50 text-slate-800 font-bold py-3 px-6 rounded-full shadow-lg transform transition-all hover:scale-110 active:scale-95 border-2 border-slate-100`;
                    btn.innerText = opt;
                    btn.style.animation = `float-up 3s ease-in-out infinite ${delay}s`; // Use custom keyframe

                    btn.onclick = () => this.handleChoice(opt, btn);
                    container.appendChild(btn);
                });
            },

            updateHUD: function () {
                const levelContainer = document.getElementById('level-indicator');
                if (!levelContainer) return;
                levelContainer.innerHTML = '';
                for (let i = 0; i < this.state.maxLevels; i++) {
                    const dot = document.createElement('div');
                    dot.className = `w-2 h-2 rounded-full transition-colors ${i < this.state.level ? 'bg-purple-500' : 'bg-slate-200'}`;
                    levelContainer.appendChild(dot);
                }
                const scoreDisplay = document.getElementById('score-display');
                if (scoreDisplay) scoreDisplay.innerText = this.state.score.toString().padStart(4, '0');
            },

            handleChoice: function (choice, btnElement) {
                if (this.state.isLocked) return;
                this.state.isLocked = true;

                const correct = this.state.currentVerb.yo;
                const coreOrb = document.getElementById('core-orb');

                // Disable all buttons
                const allBtns = document.getElementById('options-container').querySelectorAll('button');
                allBtns.forEach(b => b.classList.add('pointer-events-none', 'opacity-50'));
                btnElement.classList.remove('opacity-50');

                if (choice === correct) {
                    // Correct
                    this.state.score += 100;
                    if (typeof playSound === 'function') playSound('confetti');

                    // Visuals
                    btnElement.classList.remove('bg-white', 'text-slate-800');
                    btnElement.classList.add('bg-green-500', 'text-white', 'border-green-400', 'scale-125');

                    coreOrb.className = "w-32 h-32 rounded-full bg-gradient-to-br from-green-400 via-emerald-500 to-green-600 shadow-[0_0_50px_rgba(16,185,129,0.8)] flex items-center justify-center transform scale-110 transition-all duration-300 z-10 relative overflow-hidden";

                    setTimeout(() => {
                        this.state.level++;
                        this.loadLevel();
                    }, 1200);
                } else {
                    // Incorrect
                    if (typeof playSound === 'function') playSound('error');
                    this.state.score = Math.max(0, this.state.score - 50);

                    btnElement.classList.add('bg-red-500', 'text-white', 'animate-shake');

                    // Shake core
                    coreOrb.classList.add('animate-shake');
                    setTimeout(() => coreOrb.classList.remove('animate-shake'), 500);

                    setTimeout(() => {
                        this.state.isLocked = false;
                        // Re-enable buttons
                        allBtns.forEach(b => {
                            b.classList.remove('pointer-events-none', 'opacity-50', 'bg-red-500', 'text-white', 'animate-shake');
                            // Reset style if needed, but simplest is just continue
                            if (b === btnElement) {
                                b.classList.add('bg-white', 'text-slate-800');
                                b.classList.remove('bg-red-500', 'text-white');
                            }
                        });
                        this.updateHUD();
                    }, 1000);
                }
            },

            endGame: function () {
                document.getElementById('game-interface').classList.add('hidden');
                document.getElementById('game-result').classList.remove('hidden');
                document.getElementById('final-score').innerText = this.state.score;

                const msg = document.getElementById('result-message');
                if (this.state.score >= 800) {
                    msg.innerText = "Amazing! The core is fully charged!";
                    if (typeof react === 'function') react('confetti');
                } else {
                    msg.innerText = "Good effort! Try again for 100% efficiency.";
                }
            }
        };

        // Expose to global
        window.CoreGame = CoreGame;
    </script>

  <script>
    fetch('/nav.html').then(function(r){ return r.text(); }).then(function(data){
      var el = document.getElementById('header-container');
      if (el) {
      el.innerHTML = data;
      var scripts = el.querySelectorAll('script');
      for (var i = 0; i < scripts.length; i++) {
        var sc = scripts[i];
        var ns = document.createElement('script');
        if (sc.src) ns.src = sc.src; else ns.textContent = sc.textContent;
        document.body.appendChild(ns);
      }
    }
    });
  </script>

</body>

</html>